<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Menu ‚Ä¢ Laporan Kasus ‚Ä¢ Pasien</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --brand:#0A4B8F; }
    
    * {
      box-sizing: border-box;
    }
    
    html, body {
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f8fafc;
    }
    
    body {
      color: #0f172a;
      line-height: 1.5;
    }
    
    /* Utility Classes */
    .hidden {
      display: none !important;
    }
    
    .mt-1 { margin-top: 0.25rem; }
    .mt-2 { margin-top: 0.5rem; }
    .mt-3 { margin-top: 0.75rem; }
    .mt-4 { margin-top: 1rem; }
    .mt-5 { margin-top: 1.25rem; }
    .mt-6 { margin-top: 1.5rem; }
    .mt-8 { margin-top: 2rem; }
    
    .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
    .px-4 { padding-left: 1rem; padding-right: 1rem; }
    .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
    .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
    .p-4 { padding: 1rem; }
    
    .pb-2 { padding-bottom: 0.5rem; }
    .pb-24 { padding-bottom: 6rem; }
    
    .w-full { width: 100%; }
    .max-w-md { max-width: 28rem; margin-left: auto; margin-right: auto; }
    
    .flex { display: flex; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
    .gap-2 { gap: 0.5rem; }
    .gap-3 { gap: 0.75rem; }
    
    .grid { display: grid; }
    .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .gap-y-3 { row-gap: 0.75rem; }
    .gap-1 { gap: 0.25rem; }
    .gap-3 { gap: 0.75rem; }
    
    .mb-3 { margin-bottom: 0.75rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mb-5 { margin-bottom: 1.25rem; }
    
    .w-48 { width: 12rem; }
    .flex-1 { flex: 1 1 0%; }
    
    .bg-slate-100 { background-color: #f1f5f9; }
    .cursor-not-allowed { cursor: not-allowed; }
    
    .space-y-2 > * + * {
      margin-top: 0.5rem;
    }
    
    .space-y-3 > * + * {
      margin-top: 0.75rem;
    }
    
    .text-xs { font-size: 0.75rem; line-height: 1rem; }
    .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
    .text-base { font-size: 1rem; line-height: 1.5rem; }
    .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
    
    .font-medium { font-weight: 500; }
    .font-semibold { font-weight: 600; }
    .font-bold { font-weight: 700; }
    
    .text-white { color: #ffffff; }
    .text-slate-500 { color: #64748b; }
    .text-slate-600 { color: #475569; }
    .text-slate-700 { color: #334155; }
    .text-slate-900 { color: #0f172a; }
    .text-red-600 { color: #dc2626; }
    
    .bg-white { background-color: #ffffff; }
    .bg-slate-50 { background-color: #f8fafc; }
    
    .border { border-width: 1px; border-style: solid; }
    .border-t { border-top-width: 1px; border-top-style: solid; }
    .border-b { border-bottom-width: 1px; border-bottom-style: solid; }
    .border-slate-200 { border-color: #e2e8f0; }
    .border-slate-300 { border-color: #cbd5e1; }
    
    .rounded-xl { border-radius: 0.75rem; }
    .rounded-2xl { border-radius: 1rem; }
    
    .block { display: block; }
    
    /* Header */
    header {
      background-color: var(--brand);
      color: white;
    }
    
    /* Input styling */
    input[type="text"],
    input[type="tel"],
    input[type="date"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid #cbd5e1;
      border-radius: 0.75rem;
      font-size: 1rem;
      font-family: inherit;
      background-color: white;
      transition: all 0.2s;
    }
    
    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(10, 75, 143, 0.1);
    }
    
    /* Label */
    label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: #334155;
      margin-bottom: 0.25rem;
    }
    
    /* Card with border and shadow */
    .shadow-card {
      box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
      border: 1px solid #e2e8f0;
      border-radius: 1rem;
      background-color: white;
    }
    
    /* Button */
    button {
      font-family: inherit;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
    }
    
    button:hover {
      opacity: 0.9;
    }
    
    .disabled {
      opacity: 0.6;
      pointer-events: none;
      cursor: not-allowed;
    }
    
    /* Accordion */
    .accordion-content[aria-hidden="true"] {
      display: none;
    }
    
    .acc-icon {
      transition: transform 0.2s ease;
    }
    
    /* Hint text */
    .hint {
      font-size: 0.75rem;
      color: #64748b;
      line-height: 1.5;
      margin-top: 0.25rem;
      display: block;
    }
    
    /* Progress bar */
    .h-1\.5 { height: 0.375rem; }
    .overflow-hidden { overflow: hidden; }
    .rounded-full { border-radius: 9999px; }
    
    /* Footer CTA */
    #footerCTA {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: white;
      border-top: 1px solid #e2e8f0;
      z-index: 10;
    }
    
    #nextBtn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      width: 100%;
      padding: 0.75rem 1rem;
      border-radius: 1rem;
      font-weight: 600;
      color: white;
      background-color: #cbd5e1;
      transition: all 0.2s;
    }
    
    #nextBtn:not(.disabled) {
      background-color: var(--brand);
    }
    
    /* Back button */
    #backBtn {
      padding: 0.5rem;
      margin-left: -0.5rem;
      border-radius: 9999px;
      background-color: transparent;
      color: white;
    }
    
    #backBtn:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    #backBtn.opacity-50 {
      opacity: 0.5;
    }
    
    /* SVG icons */
    svg {
      display: inline-block;
      vertical-align: middle;
    }
    
    .h-5 { height: 1.25rem; }
    .w-5 { width: 1.25rem; }
    .h-6 { height: 1.5rem; }
    .w-6 { width: 1.5rem; }
    
    /* Text alignment */
    .text-left { text-align: left; }
    
    /* Hover effects */
    .hover\:bg-slate-50:hover {
      background-color: #f8fafc;
    }
    
    /* Toast / Snackbar styling */
    #toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 6rem;
      z-index: 100;
      min-width: 280px;
      max-width: 90%;
      display: none;
    }
    
    #toastMsg {
      background-color: #1e293b;
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 0.75rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      text-align: center;
      font-size: 0.875rem;
      line-height: 1.5;
    }
    
    /* Responsive */
    @media (max-width: 640px) {
      .max-w-md {
        padding-left: 1rem;
        padding-right: 1rem;
      }
    }
  </style>
</head>
<body class="bg-white text-slate-900">
  <!-- Top App Bar -->
  <header class="bg-[var(--brand)] text-white">
    <div class="max-w-md mx-auto px-4 py-3 flex items-center gap-3">
      <button id="backBtn" aria-label="Kembali" class="p-2 -ml-2 rounded-full hover:bg-white/10">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
      </button>
      <div class="flex-1">
        <div id="appTitle" class="text-base font-semibold leading-5">Menu</div>
        <div id="appSubtitle" class="text-xs opacity-90"></div>
      </div>
    </div>
    <!-- progress (case-only) -->
    <div id="progressWrap" class="max-w-md mx-auto px-4 pb-2 hidden">
      <div class="h-1.5 bg-white/20 rounded-full overflow-hidden">
        <div id="progressInner" class="h-full w-1/5 bg-white rounded-full"></div>
      </div>
    </div>
  </header>

  <main class="max-w-md mx-auto px-4 pb-24 ios-safe">
    <!-- ===================== VIEW: MENU ===================== -->
    <section id="viewMenu" class="mt-5">
      <!-- Accordion: Laporan Kasus -->
      <div class="mt-4 rounded-xl border border-slate-200 shadow-card">
        <button class="w-full flex items-center justify-between px-4 py-3 text-left font-semibold" data-acc="case">
          <span>Laporan Kasus</span>
          <svg class="h-5 w-5 acc-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div class="accordion-content" aria-hidden="true" id="acc-case">
          <div class="border-t border-slate-200">
            <button id="btnTambahCase" class="w-full flex items-center justify-between px-4 py-3 text-left hover:bg-slate-50">
              <span>Tambah Kasus Report</span>
              <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Accordion: Pasien -->
      <div class="mt-3 rounded-xl border border-slate-200 shadow-card">
        <button class="w-full flex items-center justify-between px-4 py-3 text-left font-semibold" data-acc="patient">
          <span>Pasien</span>
          <svg class="h-5 w-5 acc-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div class="accordion-content" aria-hidden="true" id="acc-patient">
          <div class="border-t border-slate-200">
            <button id="btnDaftarPasien" class="w-full flex items-center justify-between px-4 py-3 text-left hover:bg-slate-50">
              <span>Daftar Pasien</span>
              <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- ===================== VIEW: CASE FLOW ===================== -->
    <!-- SECTION 0: Pilih Jenis Laporan -->
    <section id="sec0" class="mt-5 hidden">
      <p class="text-lg font-semibold text-slate-900">Pilih Jenis Laporan Kasus</p>
      <div class="mt-4 grid gap-3">
        <label class="flex items-center gap-3 p-4 border rounded-2xl shadow-card cursor-pointer hover:bg-slate-50">
          <input type="radio" name="jenisLaporan" id="lapGigitan" value="Gigitan Hewan" class="accent-[var(--brand)]">
          <div>
            <div class="font-semibold">Gigitan Hewan</div>
            <div class="text-sm text-slate-600">Laporan kasus gigitan hewan pada manusia</div>
          </div>
        </label>
      </div>
    </section>

    <!-- SECTION 1: Data Pasien -->
    <section id="sec1" class="hidden">
      <p class="text-lg font-semibold text-slate-900 mb-5">Data Pasien</p>

      <div class="mb-5">
        <label for="nik" class="block text-sm font-medium text-slate-700 mb-2">NIK <span class="text-red-600">*</span></label>
        <input id="nik" maxlength="16" inputmode="numeric" pattern="[0-9]*"
               class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[var(--brand)]"
               placeholder="16 digit NIK" />
        <p id="nikErr" class="hidden text-xs text-red-600 mt-1">NIK harus 16 digit angka.</p>
        <p class="hint mt-1">Otomatis mengisi Tanggal Lahir, Usia, Jenis Kelamin, Provinsi, Kab/Kota.</p>
      </div>

      <div class="mb-5">
        <label for="namaLengkap" class="block text-sm font-medium text-slate-700 mb-2">Nama Lengkap <span class="text-red-600">*</span></label>
        <input id="namaLengkap" type="text"
               class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[var(--brand)]"
               placeholder="Nama lengkap pasien" />
      </div>

      <div class="mb-5 rounded-2xl border border-slate-200 shadow-card">
        <div class="px-4 py-3 bg-slate-50 border-b border-slate-200 text-sm font-semibold text-slate-700">
          Data Identitas dari NIK
        </div>
        <div class="p-4 grid grid-cols-2 gap-y-3 text-sm">
          <div class="text-slate-600">Tanggal Lahir</div>
          <div id="dob" class="font-semibold">‚Äî</div>

          <div class="text-slate-600">Usia</div>
          <div id="age" class="font-semibold">‚Äî</div>

          <div class="text-slate-600">Jenis Kelamin</div>
          <div id="gender" class="font-semibold">‚Äî</div>

          <div class="text-slate-600">Provinsi</div>
          <div id="prov" class="font-semibold">‚Äî</div>

          <div class="text-slate-600">Kabupaten/Kota</div>
          <div id="kab" class="font-semibold">‚Äî</div>
        </div>
      </div>

      <div class="mb-5">
        <label for="kec" class="block text-sm font-medium text-slate-700 mb-2">Kecamatan <span class="text-red-600">*</span></label>
        <select id="kec"
                class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
          <option value="">Pilih kecamatan‚Ä¶</option>
        </select>
        <p class="hint mt-1">Daftar kecamatan mengikuti Kab/Kota dari NIK.</p>
      </div>

      <div class="mb-5">
        <label for="kel" class="block text-sm font-medium text-slate-700 mb-2">Kelurahan/Desa <span class="text-red-600">*</span></label>
        <select id="kel"
                class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
          <option value="">Pilih kelurahan/desa‚Ä¶</option>
        </select>
        <p class="hint mt-1">Daftar kelurahan/desa mengikuti Kecamatan yang dipilih.</p>
      </div>

      <div class="mb-5">
        <label for="alamatKejadian" class="block text-sm font-medium text-slate-700 mb-2">Alamat Lengkap Kejadian <span class="text-red-600">*</span></label>
        <textarea id="alamatKejadian" rows="3"
          class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[var(--brand)]"
          placeholder="Nama jalan, RT/RW, kelurahan/desa, patokan‚Ä¶"></textarea>
      </div>

      <div class="mb-5">
        <label class="flex items-center cursor-pointer">
          <input type="checkbox" id="sameAsKejadian" class="w-4 h-4 rounded border-slate-300 text-[var(--brand)] focus:ring-2 focus:ring-[var(--brand)]">
          <span class="ml-2 text-sm text-slate-700">Sama dengan alamat lengkap kejadian</span>
        </label>
      </div>

      <div class="mb-5">
        <label for="alamatDomisili" class="block text-sm font-medium text-slate-700 mb-2">Alamat Domisili Pasien (Opsional)</label>
        <textarea id="alamatDomisili" rows="3"
          class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[var(--brand)]"
          placeholder="Isi bila berbeda dengan alamat kejadian"></textarea>
      </div>

      <div class="mb-5">
        <label for="telp" class="block text-sm font-medium text-slate-700 mb-2">No. Telepon (Opsional)</label>
        <input id="telp" type="tel" inputmode="tel"
               class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[var(--brand)]"
               placeholder="08xxxxxxxxxx"/>
      </div>
    </section>

    <!-- SECTION 2: Kondisi Hewan -->
    <section id="sec2" class="mt-8 hidden">
      <p class="text-lg font-semibold text-slate-900 mb-5">Kondisi Hewan</p>

      <div class="mb-5">
        <label class="block text-sm font-medium text-slate-700 mb-2">Tanggal Digigit <span class="text-red-600">*</span></label>
        <input id="tanggalDigigit" type="date" class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[var(--brand)]"/>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-slate-700 mb-2">Jenis Hewan <span class="text-red-600">*</span></label>
        <select id="jenisHewan" class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
          <option value="">Pilih salah satu‚Ä¶</option>
          <option>Anjing</option>
          <option>Kucing</option>
          <option>Kera</option>
          <option>Lainnya</option>
        </select>
      </div>
	  
	  <div id="jenisHewanLainnyaWrap" class="mb-5 hidden">
  <label for="jenisHewanLainnya" class="block text-sm font-medium text-slate-700 mb-2">
    Sebutkan Jenis Hewan Lainnya <span class="text-red-600">*</span>
  </label>
  <input id="jenisHewanLainnya" type="text"
         class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[var(--brand)]"
         placeholder="Contoh: Monyet, Musang, Babi Hutan, dll"/>
  <p class="hint mt-1">Isi field ini jika memilih "Lainnya" pada Jenis Hewan.</p>
</div>

<div class="mb-5">
        <label class="block text-sm font-medium text-slate-700 mb-2">
          Area Gigitan (bisa pilih lebih dari satu) <span class="text-red-600">*</span>
        </label>
        <div id="lokasiGigitanWrap" class="mt-2 grid grid-cols-1 gap-2 text-sm">
          
          <label class="flex items-start gap-3 p-3 border border-slate-200 rounded-xl hover:bg-slate-50 cursor-pointer transition">
  <input type="checkbox" value="Kepala" class="mt-1 lokasi-gigitan-checkbox accent-[var(--brand)]">
  <span>Kepala</span>
</label>

<label class="flex items-start gap-3 p-3 border border-slate-200 rounded-xl hover:bg-slate-50 cursor-pointer transition">
  <input type="checkbox" value="Leher" class="mt-1 lokasi-gigitan-checkbox accent-[var(--brand)]">
  <span>Leher</span>
</label>
          
          <label class="flex items-start gap-3 p-3 border border-slate-200 rounded-xl hover:bg-slate-50 cursor-pointer transition">
            <input type="checkbox" value="Tangan" class="mt-1 lokasi-gigitan-checkbox accent-[var(--brand)]">
            <span>Tangan</span>
          </label>
          
          <label class="flex items-start gap-3 p-3 border border-slate-200 rounded-xl hover:bg-slate-50 cursor-pointer transition">
            <input type="checkbox" value="Kaki" class="mt-1 lokasi-gigitan-checkbox accent-[var(--brand)]">
            <span>Kaki</span>
          </label>
          
          <label class="flex items-start gap-3 p-3 border border-slate-200 rounded-xl hover:bg-slate-50 cursor-pointer transition">
            <input type="checkbox" value="Badan" class="mt-1 lokasi-gigitan-checkbox accent-[var(--brand)]">
            <span>Badan</span>
          </label>
          
          <label class="flex items-start gap-3 p-3 border border-slate-200 rounded-xl hover:bg-slate-50 cursor-pointer transition">
            <input type="checkbox" value="Lainnya" class="mt-1 lokasi-gigitan-checkbox accent-[var(--brand)]" id="lokasiGigitanLainnyaCheckbox">
            <span>Lainnya</span>
          </label>
          
        </div>
        <p id="lokasiGigitanErr" class="hidden text-xs text-red-600 mt-1">Pilih minimal satu area gigitan.</p>
      </div>

	<div id="lokasiGigitanLainnyaWrap" class="mb-5 hidden">
		<label for="lokasiGigitanLainnya" class="block text-sm font-medium text-slate-700 mb-2">
		Sebutkan Area Gigitan Lainnya <span class="text-red-600">*</span>
		</label>
		<input id="lokasiGigitanLainnya" type="text"
         class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[var(--brand)]"
         placeholder="Contoh: Punggung, Paha, Perut, dll"/>
		<p class="hint mt-1">Isi field ini jika memilih "Lainnya" pada Area Gigitan.</p>
	</div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-slate-700 mb-2">Kondisi Luka <span class="text-red-600">*</span></label>
        <select id="kondisiLuka" class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
          <option value="">Pilih salah satu‚Ä¶</option>
          <option>Luka Gigitan</option>
          <option>Lecet</option>
          <option>Luka Dalam</option>
          <option>Luka Lebar</option>
          <option>Lainnya</option>
        </select>
      </div>

<div id="kondisiLukaLainnyaWrap" class="mb-5 hidden">
  <label for="kondisiLukaLainnya" class="block text-sm font-medium text-slate-700 mb-2">
    Sebutkan Kondisi Luka Lainnya <span class="text-red-600">*</span>
  </label>
  <input id="kondisiLukaLainnya" type="text"
         class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[var(--brand)]"
         placeholder="Jelaskan kondisi luka secara detail"/>
  <p class="hint mt-1">Isi field ini jika memilih "Lainnya" pada Kondisi Luka.</p>
</div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-slate-700 mb-2">Pengobatan <span class="text-red-600">*</span></label>
        <select id="pengobatan" class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
          <option value="">Pilih salah satu‚Ä¶</option>
          <option>Cuci luka s.d 12 jam</option>
          <option>Cuci luka > 12 jam</option>
          <option>Tidak cuci luka</option>
        </select>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-slate-700 mb-2">Kategori atas Gigitan</label>
        <select id="kategoriGigitan" class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
          <option value="">Pilih salah satu‚Ä¶</option>
          <option>Kategori 1 (Belum digigit cukup dicuci )</option>
          <option>Kategori 2 (Gigit hanya lecet tanpa darah)</option>
          <option>Kategori 3(Menembus kulit tunggal/banyak)</option>
        </select>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-slate-700 mb-2">Status Kepemilikan Hewan <span class="text-red-600">*</span></label>
        <select id="statusPemilik" class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
          <option value="">Pilih salah satu‚Ä¶</option>
          <option>Milik Sendiri</option>
          <option>Hewan Diliarkan</option>
          <option>Hewan Liar</option>
          <option>Tidak Tahu</option>
        </select>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-slate-700 mb-2">Status Kondisi Hewan <span class="text-red-600">*</span></label>
        <select id="statusHewan" class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
          <option value="">Pilih salah satu‚Ä¶</option>
          <option>Mati</option>
          <option>Hilang</option>
          <option>Masih Hidup dan diobservasi</option>
          <option>Mati Dibunuh</option>
		  <option>Mati untuk Observasi</option>
        </select>
      </div>

      <div class="mb-5">
        <div class="text-sm font-medium text-slate-700 mb-2">Gejala yang diamati (pilih semua yang sesuai) <span class="text-red-600">*</span></div>
        <div id="symptomsWrap" class="mt-2 grid grid-cols-1 gap-2 text-sm">
          <label class="flex items-start gap-3"><input type="checkbox" value="Perubahan perilaku" class="mt-1"> <span>Perubahan perilaku (agresif / tidak mau makan / menyendiri)</span></label>
          <label class="flex items-start gap-3"><input type="checkbox" value="Hiperaktif" class="mt-1"> <span>Hiperaktif / menyerang tanpa sebab</span></label>
          <label class="flex items-start gap-3"><input type="checkbox" value="Hipersalivasi" class="mt-1"> <span>Hipersalivasi (liur berlebihan)</span></label>
          <label class="flex items-start gap-3"><input type="checkbox" value="Suara parau" class="mt-1"> <span>Suara parau / tidak bisa menggonggong</span></label>
          <label class="flex items-start gap-3"><input type="checkbox" value="Takut air" class="mt-1"> <span>Takut air (hidrofobia)</span></label>
          <label class="flex items-start gap-3"><input type="checkbox" value="Kelumpuhan" class="mt-1"> <span>Kelumpuhan rahang atau anggota tubuh</span></label>
          <label class="flex items-start gap-3"><input type="checkbox" value="Disorientasi" class="mt-1"> <span>Disorientasi / kejang</span></label>
          <label class="flex items-start gap-3"><input type="checkbox" value="Tidak ada gejala" class="mt-1"> <span>Tidak ada gejala</span></label>
          <label class="flex items-start gap-3"><input type="checkbox" value="Tidak tahu" class="mt-1"> <span>Tidak tahu</span></label>
        </div>
        <p id="symErr" class="hidden text-xs text-red-600 mt-1">Pilih minimal satu gejala.</p>
      </div>
    </section>

    <!-- SECTION 3: Pemeriksaan Laboratorium -->
    <section id="sec3" class="mt-8 hidden">
      <p class="text-lg font-semibold text-slate-900 mb-5">Pemeriksaan Laboratorium</p>
      <div class="mb-5">
        <label class="block text-sm font-medium text-slate-700 mb-2">Apakah ada hasil laboratorium pemeriksaan hewan? <span class="text-red-600">*</span></label>
        <div class="mt-2 flex gap-6 text-sm">
          <label class="inline-flex items-center gap-2"><input type="radio" name="hasLab" value="ya"> <span>Ya</span></label>
          <label class="inline-flex items-center gap-2"><input type="radio" name="hasLab" value="tidak"> <span>Tidak</span></label>
        </div>
      </div>
      <p class="hint mt-3">Jika "Ya" maka lanjut ke input hasil laboratorium. Jika "Tidak" maka selesai pengisian laporan kasus gigitan hewan.</p>
    </section>

    <!-- SECTION 4: Hasil Pemeriksaan Laboratorium -->
    <section id="sec4" class="mt-8 hidden">
      <p class="text-lg font-semibold text-slate-900 mb-5">Hasil Pemeriksaan Laboratorium</p>

      <div class="mb-5">
        <label class="block text-sm font-medium text-slate-700 mb-2">Laboratorium <span class="text-red-600">*</span></label>
        <select id="labName" class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
          <option value="">Pilih salah satu‚Ä¶</option>
          <option>Balai Besar Veteriner</option>
          <option>Balai Veteriner</option>
        </select>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-slate-700 mb-2">Jenis Spesimen <span class="text-red-600">*</span></label>
        <input id="specimenType" type="text" class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[var(--brand)]" placeholder="Contoh: jaringan otak / brain tissue"/>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-slate-700 mb-2">ID Spesimen <span class="text-red-600">*</span></label>
        <input id="specimenId" type="text" class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[var(--brand)]" placeholder="Contoh: RAB-0825-001"/>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-slate-700 mb-2">Tanggal Pengambilan Sampel <span class="text-red-600">*</span></label>
        <input id="collectionDate" type="date" class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[var(--brand)]"/>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-slate-700 mb-2">Tanggal Hasil Diterbitkan <span class="text-red-600">*</span></label>
        <input id="resultDate" type="date" class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[var(--brand)]"/>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-slate-700 mb-2">Metode Pemeriksaan <span class="text-red-600">*</span></label>
        <select id="examMethod" class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
          <option value="">Pilih salah satu‚Ä¶</option>
          <option>FAT (Fluorescent Antibody Test)</option>
          <option>RT-PCR (Reverse Transcriptase PCR)</option>
          <option>DRIT (Direct Rapid Immunohistochemical Test)</option>
        </select>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-slate-700 mb-2">Peralatan Utama <span class="text-red-600">*</span></label>
        <select id="equipment" class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
          <option value="">Pilih salah satu‚Ä¶</option>
          <option>Mikroskop Fluoresensi</option>
          <option>Sistem PCR</option>
        </select>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-slate-700 mb-2">Bahan Habis Pakai / Reagen <span class="text-red-600">*</span></label>
        <select id="reagent" class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
          <option value="">Pilih salah satu‚Ä¶</option>
          <option>Rabies Antibody Conjugate</option>
          <option>PCR Master Mix</option>
        </select>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-slate-700 mb-2">Hasil Pemeriksaan <span class="text-red-600">*</span></label>
        <select id="examResult" class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
          <option value="">Pilih salah satu‚Ä¶</option>
          <option>Positif Rabies Virus</option>
          <option>Negatif Rabies Virus</option>
        </select>
      </div>
    </section>

    <!-- ===================== VIEW: LIST PASIEN ===================== -->
    <section id="viewPatients" class="mt-5 hidden">
      <p class="text-lg font-semibold text-slate-900">Daftar Pasien</p>
      <div class="mt-3">
        <input id="searchPatient" class="w-full rounded-xl border border-slate-300 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--brand)]" placeholder="Cari nama atau NIK‚Ä¶"/>
      </div>
      <div id="patientList" class="mt-4 grid gap-4"></div>
      <p id="patientEmpty" class="mt-6 text-sm text-slate-500 hidden">Belum ada data pasien.</p>
    </section>

    <!-- ===================== VIEW: DETAIL PASIEN ===================== -->
    <section id="viewPatientDetail" class="mt-5 hidden">
      <p class="text-lg font-semibold text-slate-900 mb-4">Detail Pasien</p>
      
      <!-- Patient Data Section -->
      <div class="rounded-2xl overflow-hidden border bg-white shadow-card mb-4">
        <div class="px-4 py-3 bg-slate-50 border-b">
          <div class="font-semibold text-slate-900">Data Pasien</div>
        </div>
        <div class="p-4 text-sm">
          <div class="space-y-3">
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Tanggal Input</div>
              <div id="detInputDate" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">NIK</div>
              <div id="detNik" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Nama Lengkap</div>
              <div id="detName" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Jenis Kelamin</div>
              <div id="detGender" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Tanggal Lahir</div>
              <div id="detBirthDate" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Provinsi</div>
              <div id="detProvince" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Kabupaten/Kota</div>
              <div id="detDistrict" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Kecamatan</div>
              <div id="detKec" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Kelurahan/Desa</div>
              <div id="detKel" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Alamat Lengkap Kejadian</div>
              <div id="detRegisteredAddress" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Alamat Domisili</div>
              <div id="detResidentialAddress" class="font-semibold text-slate-900"></div>
            </div>

            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">No. Telepon</div>
              <div id="detPhone" class="font-semibold text-slate-900"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Case Report Section -->
      <div class="rounded-2xl overflow-hidden border bg-white shadow-card mb-4">
        <div class="px-4 py-3 bg-slate-50 border-b">
          <div class="font-semibold text-slate-900">Laporan Kasus</div>
        </div>
        <div class="p-4 text-sm">
          <div class="space-y-3">
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Diagnosis Klinis</div>
              <div id="detDiagnosis" class="font-semibold text-slate-900"></div>
            </div>

            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Tanggal Digigit</div>
              <div id="detTanggalDigigit" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Jenis Hewan</div>
              <div id="detAnimalType" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Lokasi Gigitan</div>
              <div id="detBiteLocation" class="font-semibold text-slate-900"></div>
            </div>

            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Kondisi Luka</div>
              <div id="detKondisiLuka" class="font-semibold text-slate-900"></div>
            </div>

            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Pengobatan</div>
              <div id="detPengobatan" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Kategori Gigitan</div>
              <div id="detBiteCategory" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Kepemilikan Hewan</div>
              <div id="detAnimalOwnership" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Status Hewan</div>
              <div id="detAnimalStatus" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Gejala</div>
              <div id="detSymptoms" class="font-semibold text-slate-900"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Laboratory Examination Section -->
      <div id="detLabSection" class="rounded-2xl overflow-hidden border bg-white shadow-card hidden">
        <div class="px-4 py-3 bg-slate-50 border-b">
          <div class="font-semibold text-slate-900">Pemeriksaan Laboratorium</div>
        </div>
        <div class="p-4 text-sm">
          <div class="grid grid-cols-[160px_1fr] gap-2 mb-3">
            <div class="text-slate-600">Pemeriksaan Lab Dilakukan?</div>
            <div class="font-semibold text-slate-900">Jawaban: <span id="detLabAnswer"></span></div>
          </div>
          
          <div id="detLabDetails" class="hidden space-y-3">
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Laboratorium</div>
              <div id="detLaboratory" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Jenis Spesimen</div>
              <div id="detSpecimenType" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">ID Spesimen</div>
              <div id="detSpecimenId" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Tanggal Pengambilan</div>
              <div id="detCollectionDate" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Tanggal Hasil</div>
              <div id="detResultDate" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Metode Pemeriksaan</div>
              <div id="detExamMethod" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Peralatan</div>
              <div id="detEquipment" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Bahan Habis Pakai (Reagen)</div>
              <div id="detReagent" class="font-semibold text-slate-900"></div>
            </div>
            
            <div class="grid grid-cols-[160px_1fr] gap-2">
              <div class="text-slate-600">Hasil Pemeriksaan</div>
              <div id="detExamResult" class="font-semibold text-slate-900"></div>
            </div>
          </div>
        </div>
      </div>
	  
	  <div style="margin-top: 20px;">
    <button id="btnEditLab" onclick="showEditLabForm()" 
            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
      ‚úèÔ∏è Edit Data Lab
    </button>
  </div>
    </section>
    <!-- ============================================ -->
    <!-- VIEW: EDIT PEMERIKSAAN LAB -->
    <!-- ============================================ -->
    <section id="viewEditLab" class="mt-5 hidden">
      <div class="flex items-center gap-3 mb-6">
        <button onclick="cancelEditLab()" class="p-2 hover:bg-slate-100 rounded-lg transition">
          <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
        </button>
        <p class="text-lg font-semibold text-slate-900">Edit Pemeriksaan Laboratorium</p>
      </div>

      <form id="formEditLab" class="space-y-4">
        
        <!-- Apakah ada Lab -->
        <div class="rounded-2xl overflow-hidden border bg-white shadow-card">
          <div class="px-4 py-3 bg-slate-50 border-b">
            <label class="block text-sm font-medium text-slate-700">
              Apakah sudah dilakukan pemeriksaan lab? <span class="text-red-600">*</span>
            </label>
          </div>
          <div class="p-4">
            <div class="flex gap-4">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="editHasLab" value="ya" id="editHasLabYa" class="edit-has-lab-radio accent-[var(--brand)]">
                <span>Ya</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="editHasLab" value="tidak" id="editHasLabTidak" class="edit-has-lab-radio accent-[var(--brand)]">
                <span>Tidak</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Field Lab (hidden by default) -->
        <div id="editLabFieldsWrap" class="space-y-4" style="display:none;">
          
          <!-- Nama Lab -->
          <div class="rounded-2xl overflow-hidden border bg-white shadow-card">
            <div class="px-4 py-3 bg-slate-50 border-b">
              <label for="editLabName" class="block text-sm font-medium text-slate-700">
                Laboratorium <span class="text-red-600">*</span>
              </label>
            </div>
            <div class="p-4">
              <select id="editLabName" 
                      class="w-full px-4 py-3 border border-slate-300 rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
                <option value="">Pilih salah satu‚Ä¶</option>
                <option>Balai Besar Veteriner</option>
                <option>Balai Veteriner</option>
              </select>
            </div>
          </div>

          <!-- Jenis Spesimen -->
          <div class="rounded-2xl overflow-hidden border bg-white shadow-card">
            <div class="px-4 py-3 bg-slate-50 border-b">
              <label for="editSpecimenType" class="block text-sm font-medium text-slate-700">
                Jenis Spesimen <span class="text-red-600">*</span>
              </label>
            </div>
            <div class="p-4">
              <input type="text" id="editSpecimenType" 
                     class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-[var(--brand)]"
                     placeholder="Contoh: Otak, Air Liur">
            </div>
          </div>

          <!-- ID Spesimen -->
          <div class="rounded-2xl overflow-hidden border bg-white shadow-card">
            <div class="px-4 py-3 bg-slate-50 border-b">
              <label for="editSpecimenId" class="block text-sm font-medium text-slate-700">
                ID Spesimen
              </label>
            </div>
            <div class="p-4">
              <input type="text" id="editSpecimenId" 
                     class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-[var(--brand)]"
                     placeholder="Contoh: SP-2024-001">
            </div>
          </div>

          <!-- Tanggal Pengambilan -->
          <div class="rounded-2xl overflow-hidden border bg-white shadow-card">
            <div class="px-4 py-3 bg-slate-50 border-b">
              <label for="editCollectionDate" class="block text-sm font-medium text-slate-700">
                Tanggal Pengambilan Spesimen <span class="text-red-600">*</span>
              </label>
            </div>
            <div class="p-4">
              <input type="date" id="editCollectionDate" 
                     class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
            </div>
          </div>

          <!-- Tanggal Hasil -->
          <div class="rounded-2xl overflow-hidden border bg-white shadow-card">
            <div class="px-4 py-3 bg-slate-50 border-b">
              <label for="editResultDate" class="block text-sm font-medium text-slate-700">
                Tanggal Hasil Lab <span class="text-red-600">*</span>
              </label>
            </div>
            <div class="p-4">
              <input type="date" id="editResultDate" 
                     class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
            </div>
          </div>

          <!-- Metode -->
          <div class="rounded-2xl overflow-hidden border bg-white shadow-card">
            <div class="px-4 py-3 bg-slate-50 border-b">
              <label for="editExamMethod" class="block text-sm font-medium text-slate-700">
                Metode Pemeriksaan <span class="text-red-600">*</span>
              </label>
            </div>
            <div class="p-4">
              <select id="editExamMethod" 
                      class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
                <option value="">Pilih salah satu‚Ä¶</option>
                <option>FAT (Fluorescent Antibody Test)</option>
                <option>RT-PCR (Reverse Transcriptase PCR)</option>
                <option>DRIT (Direct Rapid Immunohistochemical Test)</option>
              </select>
            </div>
          </div>

          <!-- Alat -->
          <div class="rounded-2xl overflow-hidden border bg-white shadow-card">
            <div class="px-4 py-3 bg-slate-50 border-b">
              <label for="editEquipment" class="block text-sm font-medium text-slate-700">
                Peralatan Utama <span class="text-red-600">*</span>
              </label>
            </div>
            <div class="p-4">
              <select id="editEquipment" 
                      class="w-full px-4 py-3 border border-slate-300 rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
                <option value="">Pilih salah satu‚Ä¶</option>
                <option>Mikroskop Fluoresensi</option>
                <option>Sistem PCR</option>
              </select>
            </div>
          </div>

          <!-- Reagen -->
          <div class="rounded-2xl overflow-hidden border bg-white shadow-card">
            <div class="px-4 py-3 bg-slate-50 border-b">
              <label for="editReagent" class="block text-sm font-medium text-slate-700">
                Bahan Habis Pakai / Reagen <span class="text-red-600">*</span>
              </label>
            </div>
            <div class="p-4">
              <select id="editReagent" 
                      class="w-full px-4 py-3 border border-slate-300 rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
                <option value="">Pilih salah satu‚Ä¶</option>
                <option>Rabies Antibody Conjugate</option>
                <option>PCR Master Mix</option>
              </select>
            </div>
          </div>

          <!-- Hasil -->
          <div class="rounded-2xl overflow-hidden border bg-white shadow-card">
            <div class="px-4 py-3 bg-slate-50 border-b">
              <label for="editExamResult" class="block text-sm font-medium text-slate-700">
                Hasil Pemeriksaan <span class="text-red-600">*</span>
              </label>
            </div>
            <div class="p-4">
              <select id="editExamResult" 
                      class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-[var(--brand)]">
                <option value="">Pilih salah satu‚Ä¶</option>
                <option>Positif Rabies Virus</option>
                <option>Negatif Rabies Virus</option>
              </select>
            </div>
          </div>

        </div>

        <!-- Action Buttons -->
        <div class="flex gap-3 pt-4 pb-4">
          <button type="button" onclick="saveEditLab()" 
                  class="flex-1 px-6 py-3 bg-green-600 text-white rounded-xl hover:bg-green-700 font-semibold transition">
            üíæ Simpan Perubahan
          </button>
          <button type="button" onclick="cancelEditLab()" 
                  class="flex-1 px-6 py-3 bg-gray-300 text-gray-700 rounded-xl hover:bg-gray-400 font-semibold transition">
            Batal
          </button>
        </div>

      </form>
    </section>


    <!-- Footer CTA (case-only) -->
    <div id="footerCTA" class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 ios-safe hidden">
      <div class="max-w-md mx-auto px-4 py-3">
        <button id="nextBtn"
          class="w-full flex items-center justify-center gap-2 rounded-2xl bg-slate-300 text-white py-3 font-semibold transition disabled">
          <span>Berikutnya</span>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
        </button>
      </div>
    </div>

    <!-- Toast / Snackbar -->
    <div id="toast" class="fixed left-1/2 -translate-x-1/2 bottom-24 z-50 hidden">
      <div id="toastMsg" class="bg-slate-900 text-white px-4 py-3 rounded-xl shadow-card text-sm"></div>
    </div>
  </main>
  <!-- Script: ADM dengan kelurahan (contoh untuk beberapa kecamatan) -->
  <script>
    const ADM = {
      // PROVINSI BALI (Kode: 51)
      "51": { 
        name: "PROV. BALI", 
        kab: { 
          "5101": { 
            name: "KAB. JEMBRANA", 
            kec: {
              "Melaya": ["Melaya", "Tuwed", "Dangin Tukadaya", "Gilimanuk", "Ekasari", "Warnasari", "Manistutu", "Kaliakah"],
              "Negara": ["Banjar Tengah", "Banjar Jawa", "Lelateng", "Pendem", "Kaliuntu", "Baluk", "Dauhwaru", "Banyubiru"],
              "Jembrana": ["Tegal Badeng", "Pergung", "Sangkaragung", "Dangin Tukadaya Tengah", "Yehembang"],
              "Mendoyo": ["Mendoyo Dangin Tukad", "Mendoyo Dauh Tukad", "Penyaringan", "Delod Berawah", "Yeh Sumbul"],
              "Pekutatan": ["Pekutatan", "Manggissari", "Pangyangan", "Gumbrih", "Medewi"]
            }
          },
          "5102": { 
            name: "KAB. TABANAN", 
            kec: {
              "Selemadeg": ["Bajera", "Beraban", "Megati", "Pupuan Sawah", "Tangguntiti", "Antap", "Wanagiri"],
              "Selemadeg Timur": ["Gadungan", "Lalanglinggah", "Mundeh", "Mundeh Kangin", "Tegal Mengkeb"],
              "Selemadeg Barat": ["Angkah", "Bajera Utara", "Bantas", "Dalang", "Galungan"],
              "Kerambitan": ["Baturiti", "Kelating", "Kerambitan", "Kesiut", "Kukuh", "Meliling"],
              "Tabanan": ["Bongan", "Dauh Paken", "Delod Peken", "Denbantas", "Gubug", "Subamia", "Sudimara"],
              "Kediri": ["Banjar Anyar", "Buwit", "Cepaka", "Kediri", "Nyambu", "Pandak Bandung", "Pandak Gede"],
              "Marga": ["Marga", "Marga Dajan Puri", "Marga Dauh Puri", "Sanggulan", "Selanbawak", "Tua", "Kukuh"],
              "Baturiti": ["Antapan", "Apuan", "Batunya", "Baturiti", "Candikuning", "Luwus", "Mekarsari"],
              "Penebel": ["Jatiluwih", "Penatahan", "Penebel", "Sangketan", "Senganan", "Tana Lot"],
              "Pupuan": ["Batungsel", "Karya Sari", "Kebon Padang", "Munduk Temu", "Pajahan", "Pupuan"]
            }
          },
          "5103": { 
            name: "KAB. BADUNG", 
            kec: {
              "Kuta": ["Kuta", "Kedonganan", "Tuban", "Legian", "Seminyak"],
              "Kuta Selatan": ["Benoa", "Jimbaran", "Kutuh", "Pecatu", "Tanjung Benoa", "Ungasan"],
              "Kuta Utara": ["Canggu", "Dalung", "Kerobokan", "Kerobokan Kelod", "Sempidi", "Tibubeneng"],
              "Mengwi": ["Abianbase", "Kapal", "Kekeran", "Mengwi", "Pererenan", "Sading", "Sembung"],
              "Abiansemal": ["Abiansemal", "Angantaka", "Baha", "Blahkiuh", "Dalung", "Darmasaba", "Jagapati"],
              "Petang": ["Belok", "Getasan", "Pangsan", "Petang", "Sulangai"]
            }
          },
          "5104": { 
            name: "KAB. GIANYAR", 
            kec: {
              "Sukawati": ["Batuan", "Batubulan", "Celuk", "Guwang", "Ketewel", "Singapadu", "Sukawati"],
              "Blahbatuh": ["Beng", "Blahbatuh", "Bedulu", "Buruan", "Keramas", "Medahan", "Saba"],
              "Gianyar": ["Bitera", "Gianyar", "Petak Kaja", "Samplangan", "Siangan", "Sumita", "Tegal Tugu"],
              "Tampaksiring": ["Manukaya", "Pejeng", "Pejeng Kaja", "Pejeng Kangin", "Sanding", "Tampaksiring"],
              "Ubud": ["Kedewatan", "Lodtunduh", "Mas", "Peliatan", "Petulu", "Sayan", "Singakerta", "Ubud"],
              "Tegallalang": ["Kedisan", "Kenderan", "Pupuan", "Taro", "Tegallalang"],
              "Payangan": ["Buahan", "Buahan Kaja", "Bukian", "Kerta", "Melinggih", "Payangan"]
            }
          },
          "5105": { 
            name: "KAB. KLUNGKUNG", 
            kec: {
              "Nusa Penida": ["Batukandik", "Batumadeg", "Bunga Mekar", "Klumpu", "Lembongan", "Ped", "Sakti", "Suana"],
              "Banjarangkan": ["Banjarangkan", "Batubulan Kangin", "Timuhun", "Tihingan", "Tohpati"],
              "Klungkung": ["Gelgel", "Kamasan", "Semarapura Kaja", "Semarapura Kangin", "Semarapura Kelod", "Tojan"],
              "Dawan": ["Besan", "Budaga", "Dawan Kaler", "Dawan Kelod", "Jumpai", "Kusamba", "Pikat"]
            }
          },
          "5106": { 
            name: "KAB. BANGLI", 
            kec: {
              "Susut": ["Abuan", "Apuan", "Demulih", "Pengiangan", "Selat", "Sulahan", "Susut"],
              "Bangli": ["Bebalang", "Bunutin", "Cempaga", "Kayubihi", "Kubu", "Landih", "Pengotan"],
              "Tembuku": ["Bangbang", "Jehem", "Peninjoan", "Tembuku", "Undisan", "Yangapi"],
              "Kintamani": ["Abang Songan", "Awan", "Batur Selatan", "Batur Tengah", "Batur Utara", "Bayung Gede", "Catur"]
            }
          },
          "5107": { 
            name: "KAB. KARANGASEM", 
            kec: {
              "Rendang": ["Bebandem", "Menanga", "Nongan", "Pempatan", "Pesaban", "Rendang"],
              "Sidemen": ["Parangtritis", "Sidemen", "Tangkup", "Telagatawang", "Wisma Kerta"],
              "Manggis": ["Antiga", "Getakan", "Manggis", "Ngis", "Padangbai", "Selumbung", "Sengkidu"],
              "Karangasem": ["Bugbug", "Karangasem", "Pertima", "Seraya", "Seraya Barat", "Subagan"],
              "Abang": ["Abang", "Bunutan", "Culik", "Datah", "Kesimpar", "Labasari", "Tista"],
              "Bebandem": ["Bebandem", "Bungbungan", "Macang", "Sibetan", "Timbrah"],
              "Selat": ["Duda", "Dukuh", "Muncan", "Pering Sari", "Selat"],
              "Kubu": ["Ban", "Baturinggit", "Dukuh", "Kubu", "Sukadana", "Tianyar Barat", "Tianyar Tengah"]
            }
          },
          "5108": { 
            name: "KAB. BULELENG", 
            kec: {
              "Gerokgak": ["Gerokgak", "Musi", "Patas", "Pejarakan", "Pemuteran", "Sumber Kelampok", "Tinga-Tinga"],
              "Seririt": ["Angsa", "Bestala", "Busungbiu", "Joanyar", "Kalianget", "Lokapaksa", "Ringdikit"],
              "Busungbiu": ["Bengkel", "Busungbiu", "Kekeran", "Pucaksari", "Sepang", "Subuk", "Tigawasa"],
              "Banjar": ["Banjar", "Banjar Tegeha", "Banyuatis", "Dencarik", "Kayuputih", "Munduk", "Pedawa"],
              "Sukasada": ["Ambengan", "Gitgit", "Panji", "Panji Anom", "Pegadungan", "Sambangan", "Sukasada"],
              "Buleleng": ["Alasangker", "Astina", "Banjar Bali", "Banyuasri", "Beratan", "Kampung Baru", "Kaliuntu"],
              "Sawan": ["Bungkulan", "Galungan", "Gringsing", "Jagaraga", "Sangsit", "Sawan", "Sudaji"],
              "Kubutambahan": ["Bengkala", "Bontihing", "Gobleg", "Kubutambahan", "Kaliasem", "Tamblang", "Timpag"],
              "Tejakula": ["Julah", "Les", "Pacung", "Penuktukan", "Sambirenteng", "Sembiran", "Tejakula"]
            }
          },
          "5171": { 
            name: "KOTA DENPASAR", 
            kec: {
              "Denpasar Selatan": ["Dangin Puri", "Panjer", "Pedungan", "Pemogan", "Renon", "Sanur", "Sanur Kauh", "Sesetan", "Sidakarya"],
              "Denpasar Timur": ["Dangin Puri Kangin", "Dangin Puri Kauh", "Kesiman", "Kesiman Kertalangu", "Kesiman Petilan", "Penatih", "Penatih Dangin Puri", "Sumerta", "Sumerta Kauh", "Sumerta Kelod"],
              "Denpasar Barat": ["Dauh Puri", "Dauh Puri Kangin", "Dauh Puri Kauh", "Dauh Puri Kelod", "Padangsambian", "Padangsambian Kaja", "Padangsambian Kelod", "Pemecutan", "Pemecutan Kelod", "Tegal Harum", "Tegal Kerta"],
              "Denpasar Utara": ["Dangin Puri Kaja", "Dangin Puri Klod", "Peguyangan", "Peguyangan Kaja", "Peguyangan Kangin", "Pemecutan Kaja", "Tonja", "Ubung", "Ubung Kaja"]
            }
          }
        }
      },
      
      // PROVINSI SUMATERA BARAT (Kode: 13) - Contoh beberapa kecamatan dengan kelurahan
      "13": { 
        name: "PROV. SUMATERA BARAT", 
        kab: { 
          "1301": { 
            name: "KAB. KEPULAUAN MENTAWAI", 
            kec: {
              "Pagai Utara": ["Bulasat", "Madobak", "Sinaka", "Taikako"],
              "Pagai Selatan": ["Betumonga", "Malakopa", "Matobe", "Sikakap"],
              "Sipora Utara": ["Bosua", "Sabulou", "Saibi Samukop", "Sotboyak"],
              "Sipora Selatan": ["Goisooinan", "Sioban", "Sipora Jaya", "Teteburuk"],
              "Siberut Selatan": ["Bojakan", "Bubuakat", "Matotonan", "Muara Siberut"],
              "Siberut Tengah": ["Bukit Pamewa", "Cempungan", "Madobag", "Muntei"],
              "Siberut Utara": ["Maileppet", "Matotonan", "Rogdog", "Sirilogui"],
              "Siberut Barat": ["Malancan", "Mailepet", "Saliguma", "Simatalu"],
              "Siberut Barat Daya": ["Bojakan", "Madobag", "Mongan Poula", "Silabu"],
              "Sikakap": ["Makalo", "Matobe", "Saumangnyai", "Sikakap"]
            }
          },
          "1302": { 
            name: "KAB. PESISIR SELATAN", 
            kec: {
              "Bayang": ["Bayang", "Kambang", "Pasar Bayang", "Sungai Duo"],
              "Koto XI Tarusan": ["Kampung Baru", "Pasar Tarusan", "Surantih", "Tarusan"],
              "Sutera": ["Koto Berapak", "Malai", "Sutera", "Taluak"],
              "Linggo Sari Baganti": ["Air Haji", "Linggo Sari Baganti", "Pasar Lama", "Sungai Kunyit"],
              "Lunang": ["Batu Hampar", "Inderapura", "Lunang Silaut", "Pasar Baru"],
              "Basa Ampek Balai Tapan": ["Balai Tapan", "Gurun Panjang", "Mandiangin", "Silaping"],
              "Pancung Soal": ["Air Bangis", "Carocok Anau", "Pancung Soal", "Sungai Nyalo"],
              "Ranah Ampek Hulu Tapan": ["Kampung Baru", "Pasar Tapan", "Sungai Dareh", "Tapan"],
              "Batang Kapas": ["Batang Kapas", "Pasar Lama", "Sungai Nipah", "Ujung Gading"],
              "IV Jurai": ["Koto Baru", "Koto Nan IV", "Pasar IV Jurai", "Singgalang"],
              "IV Nagari Bayang Utara": ["Bayang", "Kambang Utara", "Pasar Baru", "Sungai Pinang"],
              "Silaut": ["Koto Baru", "Painan", "Silaut", "Tanjung Betung"],
              "Lengayang": ["Air Dingin", "Lengayang", "Pasar Lengayang", "Sungai Sirah"],
              "Ranah Pesisir": ["Ampang Pulai", "Kambang", "Mandeh", "Sungai Pinang"],
              "Air Pura": ["Air Pura", "Pasar Lama", "Sungai Gambir", "Tanjung Simalidu"]
            }
          },
          "1303": { 
            name: "KAB. SOLOK", 
            kec: {
              "Junjung Sirih": ["Junjung Sirih", "Koto Baru", "Pasar Junjung", "Sungai Janiah"],
              "Lembah Gumanti": ["Gumanti", "Koto Hilalang", "Pasar Gumanti", "Sungai Nanam"],
              "Pantai Cermin": ["Pasar Cermin", "Pantai Cermin", "Sungai Limau", "Tanjung Alai"],
              "Hiliran Gumanti": ["Gumanti Hilir", "Koto Gadang", "Pasar Hiliran", "Singkarak"],
              "Gunung Talang": ["Bukit Sileh", "Gunung Talang", "Pasar Talang", "Sungai Janiah"],
              "Danau Kembar": ["Danau Atas", "Danau Bawah", "Pasar Kembar", "Sungai Janiah"],
              "X Koto Singkarak": ["Koto Baru", "Pasar Singkarak", "Singkarak", "Sumpur Kudus"],
              "X Koto Diatas": ["Koto Diatas", "Pasar Atas", "Sungai Janiah", "Talang Babungo"],
              "Payung Sekaki": ["Muaro Pingai", "Pasar Sekaki", "Payung Sekaki", "Sungai Janiah"],
              "Lembang Jaya": ["Lembang Jaya", "Pasar Lembang", "Sungai Janiah", "Talang Babungo"],
              "Kubung": ["Kubung", "Pasar Kubung", "Sungai Janiah", "Talang Babungo"],
              "Tigo Lurah": ["Koto Baru", "Pasar Lurah", "Sungai Janiah", "Tigo Lurah"],
              "IX Koto Sungai Lasi": ["Koto Baru", "Pasar Lasi", "Sungai Janiah", "Sungai Lasi"],
              "Bukit Sundi": ["Bukit Sundi", "Pasar Sundi", "Sungai Janiah", "Talang Babungo"]
            }
          },
          "1309": { 
            name: "KAB. PASAMAN", 
            kec: {
              "Bonjol": ["Bonjol", "Koto Baru", "Pasar Bonjol", "Sungai Aur"],
              "Lubuk Sikaping": ["Lubuk Sikaping", "Pasar Sikaping", "Sungai Aur", "Tanjung Alai"],
              "Simpang Alahan Mati": ["Alahan Mati", "Pasar Simpang", "Simpang Alahan", "Sungai Aur"],
              "Pasaman": ["Koto Baru", "Pasar Pasaman", "Pasaman", "Sungai Aur"],
              "Mapat Tunggul": ["Koto Baru", "Mapat Tunggul", "Pasar Tunggul", "Sungai Aur"],
              "Mapat Tunggul Selatan": ["Koto Baru", "Mapat Selatan", "Pasar Selatan", "Sungai Aur"],
              "Panti": ["Koto Baru", "Pasar Panti", "Panti", "Sungai Aur"],
              "Padang Gelugur": ["Koto Baru", "Padang Gelugur", "Pasar Gelugur", "Sungai Aur"],
              "Rao": ["Koto Baru", "Pasar Rao", "Rao", "Sungai Aur"],
              "Rao Selatan": ["Koto Baru", "Pasar Selatan", "Rao Selatan", "Sungai Aur"],
              "Rao Utara": ["Koto Baru", "Pasar Utara", "Rao Utara", "Sungai Aur"],
              "Tigo Nagari": ["Koto Baru", "Pasar Tigo", "Sungai Aur", "Tigo Nagari"]
            }
          },
          "1371": { 
            name: "KOTA PADANG", 
            kec: {
              "Bungus Teluk Kabung": ["Bungus Barat", "Bungus Selatan", "Bungus Timur", "Teluk Kabung Selatan", "Teluk Kabung Tengah", "Teluk Kabung Utara"],
              "Lubuk Kilangan": ["Bandar Buat", "Batu Busuk", "Indarung", "Koto Lalang", "Lubuk Kilangan", "Lubuk Minturun", "Tarantang"],
              "Lubuk Begalung": ["Batipuh Panjang", "Kampung Jua", "Koto Baru", "Kuranji", "Parak Lawas", "Pegambiran", "Pisang"],
              "Padang Selatan": ["Batang Arau", "Flamboyan Baru", "Pasa Gadang", "Seberang Padang", "Seberang Palinggam", "Teluk Bayur"],
              "Padang Timur": ["Jati", "Kubu Marapalam", "Kurao Pagang", "Parak Gadang Timur", "Sawahan Timur", "Simpang Haru"],
              "Padang Barat": ["Belakang Tangsi", "Kampung Jao", "Kampung Pondok", "Purus", "Rimbo Kaluang", "Olo"],
              "Padang Utara": ["Air Tawar Barat", "Air Tawar Timur", "Alai Parak Kopi", "Gunung Pangilun", "Lolong Belanti", "Ulak Karang Selatan"],
              "Nanggalo": ["Gurun Laweh", "Kampung Lapai", "Kampung Olo", "Kurao Pagang", "Surau Gadang", "Tabing"],
              "Kuranji": ["Andalas", "Gunung Sarik", "Kalumbuk", "Korong Gadang", "Kuranji", "Pasar Ambacang", "Sungai Sapih"],
              "Pauh": ["Binuang Kampung Dalam", "Kapalo Koto", "Koto Luar", "Lambung Bukit", "Limau Manis", "Pauh", "Pisang"],
              "Koto Tangah": ["Air Pacah", "Batang Kabung Ganting", "Batipuh", "Dadok Tunggul Hitam", "Koto Panjang Ikua Koto", "Lubuk Buaya", "Pasie Nan Tigo"]
            }
          },
          "1372": { 
            name: "KOTA SOLOK", 
            kec: {
              "Lubuk Sikarah": ["IX Korong", "Kampung Jawa", "Koto Panjang", "Tanah Garam"],
              "Tanjung Harapan": ["Air Dingin", "Kayu Aro", "Simpang Rumbio", "Tanah Garam Selatan"]
            }
          },
          "1373": { 
            name: "KOTA SAWAHLUNTO", 
            kec: {
              "Lembah Segar": ["Kolok Nan Tuo", "Lembah Segar", "Santur", "Sapan"],
              "Talawi": ["Air Dingin", "Salak", "Sawah Lunto", "Talawi Hilir"],
              "Barangin": ["Barangin", "Muaro Kalaban", "Pasar", "Tanah Lapang"],
              "Silungkang": ["Kubang Sirakuk", "Pasar Silungkang", "Silungkang Oso", "Silungkang Tigo"]
            }
          }
        }
      },
      
      // PROVINSI NUSA TENGGARA TIMUR (Kode: 53) - Contoh beberapa kecamatan dengan kelurahan
      "53": { 
        name: "PROV. NUSA TENGGARA TIMUR", 
        kab: { 
          "5301": { 
            name: "KAB. SUMBA BARAT", 
            kec: {
              "Kota Waikabubak": ["Bukambero", "Kambaniru", "Mau Hau", "Praing Kareha", "Waikabubak"],
              "Loli": ["Bondo Kodi", "Gallu Bakul", "Loli Darat", "Loli Tasamu", "Wee Luri"],
              "Tana Righu": ["Kalena Rongo", "Lakoka Jaya", "Praibakul", "Tana Modu", "Waihura"],
              "Wanokaka": ["Kadi Wejewa", "Palakahembi", "Ratenggaro", "Waitabula", "Wanokaka"]
            }
          },
          "5302": { 
            name: "KAB. SUMBA TIMUR", 
            kec: {
              "Kambera": ["Kambera", "Kambaniru", "Laindatang", "Melolo", "Prailiu"],
              "Haharu": ["Haharu", "Kambata Bundung", "Lailunggi", "Paberiwai", "Ramuk"],
              "Umalulu": ["Kadahang", "Kambata Tana", "Lewa", "Umalulu", "Waingapu"],
              "Pahunga Lodu": ["Kambata Loku", "Loku Ranggabaki", "Mahu", "Pahunga Lodu", "Wunga"],
              "Karera": ["Karera", "Katikuloku", "Matawai Maringu", "Panenggo Ede", "Rindi"],
              "Katala Hamu Lingu": ["Hamu Lingu", "Katiku Tana", "Kuta Malo", "Lambanapu", "Tabundung"],
              "Ngadu Ngala": ["Kabaru", "Kambata Bundung", "Katikutana", "Ngadu Ngala", "Rada Mai"],
              "Nggaha Ori Angu": ["Kambatawulu", "Nggaha", "Ori Angu", "Prailiu", "Watu Hadang"],
              "Pinupahar": ["Kabunduk", "Kataka", "Pinupahar", "Prai Bakul", "Rambangaru"],
              "Waijelu": ["Kawangu", "Kambera Kaha", "Tebara", "Waijelu", "Watu Hadang"],
              "Kambata Mapambuhang": ["Kambata", "Kawangu", "Mapambuhang", "Prai Klembung", "Wunga"],
              "Wula Waijelu": ["Kambatatana", "Kanganara", "Panenggo Ede", "Waijelu", "Wula"],
              "Pandawai": ["Kadahang", "Kanatang", "Pandawai", "Rambangaru", "Tebara"],
              "Paberiwai": ["Kamanggih", "Paberiwai", "Rambangaru", "Tana Maluru", "Watu Hadang"],
              "Wulla Wai Jilu": ["Kambaniru", "Katikuloku", "Lailunggi", "Wulla", "Wai Jilu"],
              "Kahaungu Eti": ["Eti", "Kahaungu", "Kanatang", "Prai Karoku", "Watu Hadang"],
              "Matawai La Pawu": ["La Pawu", "Lewa Paku", "Mahu", "Matawai", "Watu Hadang"],
              "Kanatang": ["Kanatang", "Kawangu", "Prai Karoku", "Rambangaru", "Watu Hadang"],
              "Rindi": ["Lailunggi", "Matawai", "Praibakul", "Rindi", "Watu Hadang"],
              "Pahunga Lodu": ["Kambata Loku", "Loku Ranggabaki", "Mahu", "Pahunga Lodu", "Wunga"],
              "Pinu Pahar": ["Kabunduk", "Kataka", "Pinu Pahar", "Praibakul", "Watu Hadang"],
              "Tabundung": ["Katikuloku", "Lambanapu", "Tabundung", "Watu Hadang", "Wunga"]
            }
          },
          "5303": { 
            name: "KAB. KUPANG", 
            kec: {
              "Semau": ["Semau Barat", "Semau Selatan", "Semau Timur", "Uiasa", "Uitiuh"],
              "Semau Selatan": ["Hanes", "Hansisi", "Uitiuh Selatan", "Uiasa Selatan"],
              "Kupang Barat": ["Oelnasi", "Oesao", "Tesabela", "Tuatuka"],
              "Kupang Tengah": ["Bokong", "Camplong", "Oelnasi Tengah", "Oeteta"],
              "Kupang Timur": ["Bolok", "Oebelo", "Oelnasi Timur", "Tablolong"],
              "Sulamu": ["Oeltua", "Oelnasi", "Sulamu", "Tuatuka"],
              "Taebenu": ["Oelnasi", "Oeltua", "Taebenu", "Tuatuka"],
              "Amarasi": ["Baun", "Nononot", "Oelnasi", "Tarus"],
              "Amarasi Barat": ["Baumata", "Baumata Barat", "Oelnasi", "Tarus Barat"],
              "Amarasi Selatan": ["Baun Selatan", "Nononot Selatan", "Oelnasi", "Tarus Selatan"],
              "Amarasi Timur": ["Baun Timur", "Nononot Timur", "Oelnasi", "Tarus Timur"],
              "Fatuleu": ["Fatuleu", "Oelnasi", "Tuatuka", "Uitao"],
              "Takari": ["Oelnasi", "Takari", "Tuatuka", "Uitao"],
              "Amfoang Selatan": ["Oelnasi", "Tuatuka", "Uitao", "Kapan"],
              "Amfoang Utara": ["Oelnasi", "Tuatuka", "Uitao", "Kapan Utara"],
              "Nekamese": ["Nekamese", "Oelnasi", "Tuatuka", "Uitao"],
              "Amabi Oefeto Timur": ["Oelnasi", "Oefeto", "Tuatuka", "Uitao"],
              "Amabi Oefeto": ["Oefeto", "Oelnasi", "Tuatuka", "Uitao"],
              "Kuatnana": ["Kuatnana", "Oelnasi", "Tuatuka", "Uitao"],
              "Amfoang Barat Daya": ["Oelnasi", "Tuatuka", "Uitao", "Kapan"],
              "Amfoang Barat Laut": ["Oelnasi", "Tuatuka", "Uitao", "Kapan"],
              "Amfoang Timur": ["Oelnasi", "Tuatuka", "Uitao", "Kapan Timur"],
              "Tobu": ["Oelnasi", "Tobu", "Tuatuka", "Uitao"],
              "Fatumnasi": ["Fatumnasi", "Oelnasi", "Tuatuka", "Uitao"]
            }
          },
          "5371": { 
            name: "KOTA KUPANG", 
            kec: {
              "Alak": ["Alak", "Namosain", "Nunbaun Delha", "Nunbaun Sabu", "Penfui"],
              "Maulafa": ["Fatululi", "Maulafa", "Naikoten I", "Naikoten II", "Oebufu"],
              "Kota Raja": ["Bonipoi", "Fontein", "Nefonaek", "LLBK", "Kuanino"],
              "Kota Lama": ["Airmata", "Fatufeto", "Kelapa Lima", "Oeba", "Oesapa"],
              "Kelapa Lima": ["Kelapa Lima", "Lasiana", "Oebufu", "Oesapa Barat", "Oesapa Selatan"],
              "Oebobo": ["Fatubesi", "Fatululi", "Oebobo", "Oebufu", "Tuak Daun Merah"]
            }
          }
        }
      }
    };
  </script>

  <script>
    // ====== Global state ======
    let view = 'menu';
    let step = 0;
    let selectedPatient = null;

    // DOM refs
    const appTitle = document.getElementById('appTitle');
    const backBtn = document.getElementById('backBtn');
    const progressWrap = document.getElementById('progressWrap');
    const progressInner = document.getElementById('progressInner');
    const footerCTA = document.getElementById('footerCTA');

    const viewMenu = document.getElementById('viewMenu');
    const viewPatients = document.getElementById('viewPatients');
    const viewPatientDetail = document.getElementById('viewPatientDetail');
    const btnTambahCase = document.getElementById('btnTambahCase');
    const btnDaftarPasien = document.getElementById('btnDaftarPasien');

    // Accordion behavior
    document.querySelectorAll('[data-acc]').forEach(btn => {
      btn.addEventListener('click', () => {
        const key = btn.getAttribute('data-acc');
        const panel = document.getElementById('acc-'+key);
        const hidden = panel.getAttribute('aria-hidden') === 'true';
        panel.setAttribute('aria-hidden', hidden ? 'false' : 'true');
        const icon = btn.querySelector('.acc-icon');
        if (icon) icon.style.transform = hidden ? 'rotate(180deg)' : 'rotate(0)';
      });
    });

    btnTambahCase.addEventListener('click', () => { view='case'; step=0; showView(); updateCTA(); });
    btnDaftarPasien.addEventListener('click', () => { view='patients'; showView(); });

    backBtn.addEventListener('click', () => {
      if (view==='case') {
        if (step>0){ step--; showView(); updateCTA(); return; }
        view='menu'; showView(); return;
      }
      if (view==='patientDetail'){ view='patients'; showView(); return; }
      if (view==='patients'){ view='menu'; showView(); return; }
    });

    function showView(){
      viewMenu.classList.toggle('hidden', view!=='menu');
      document.getElementById('sec0').classList.toggle('hidden', !(view==='case' && step===0));
      document.getElementById('sec1').classList.toggle('hidden', !(view==='case' && step===1));
      document.getElementById('sec2').classList.toggle('hidden', !(view==='case' && step===2));
      document.getElementById('sec3').classList.toggle('hidden', !(view==='case' && step===3));
      document.getElementById('sec4').classList.toggle('hidden', !(view==='case' && step===4));
      viewPatients.classList.toggle('hidden', view!=='patients');
      viewPatientDetail.classList.toggle('hidden', view!=='patientDetail');
      document.getElementById('viewEditLab').classList.toggle('hidden', view!=='editLab');

      if (view==='menu') {
        appTitle.textContent = 'Menu';
        progressWrap.classList.add('hidden');
        footerCTA.classList.add('hidden');
        backBtn.classList.add('opacity-50'); backBtn.disabled = true;
      } else if (view==='case') {
        const titles = ['Pilih Jenis Laporan Kasus','Data Pasien','Kondisi Hewan','Pemeriksaan Lab','Hasil Pemeriksaan Lab'];
        appTitle.textContent = titles[step] || 'Laporan Kasus';
        progressWrap.classList.remove('hidden');
        footerCTA.classList.remove('hidden');
        backBtn.classList.remove('opacity-50'); backBtn.disabled = false;
        const widths = {0:'20%',1:'40%',2:'60%',3:'80%',4:'100%'};
        progressInner.style.width = widths[step] || '20%';
      } else if (view==='patients') {
        appTitle.textContent = 'Daftar Pasien';
        progressWrap.classList.add('hidden');
        footerCTA.classList.add('hidden');
        backBtn.classList.remove('opacity-50'); backBtn.disabled = false;
        renderPatients(searchEl.value);
      } else if (view==='patientDetail') {
        appTitle.textContent = 'Detail Pasien';
        progressWrap.classList.add('hidden');
        footerCTA.classList.add('hidden');
        backBtn.classList.remove('opacity-50'); backBtn.disabled = false;
        if (selectedPatient) renderPatientDetail(selectedPatient);
      } else if (view==='editLab') {
        appTitle.textContent = 'Edit Pemeriksaan Lab';
        progressWrap.classList.add('hidden');
        footerCTA.classList.add('hidden');
        backBtn.classList.remove('opacity-50'); backBtn.disabled = false;
      }
      window.scrollTo({top:0, behavior:'auto'});
    }

    // ====== Case flow logic ======
    const lapGigitan = document.getElementById('lapGigitan');
    const nextBtn = document.getElementById('nextBtn');

    // Section 1 refs
    const nikEl = document.getElementById('nik');
    const nikErr = document.getElementById('nikErr');
    const namaLengkap = document.getElementById('namaLengkap');
    const dobEl = document.getElementById('dob');
    const ageEl = document.getElementById('age');
    const genderEl = document.getElementById('gender');
    const provEl = document.getElementById('prov');
    const kabEl = document.getElementById('kab');
    const kecEl = document.getElementById('kec');
    const kelEl = document.getElementById('kel');
    const alamatKejadianEl = document.getElementById('alamatKejadian');

    // Section 2 refs
    const tanggalDigigit = document.getElementById('tanggalDigigit');
    const jenisHewan = document.getElementById('jenisHewan');
    const lokasiGigitanWrap = document.getElementById('lokasiGigitanWrap');
    const lokasiGigitanCheckboxes = () => document.querySelectorAll('.lokasi-gigitan-checkbox');
    const lokasiGigitanLainnyaCheckbox = document.getElementById('lokasiGigitanLainnyaCheckbox');
    const lokasiGigitanErr = document.getElementById('lokasiGigitanErr');
    const kondisiLuka = document.getElementById('kondisiLuka');
    const pengobatan = document.getElementById('pengobatan');
    const kategoriGigitan = document.getElementById('kategoriGigitan');
    const statusPemilik = document.getElementById('statusPemilik');
    const statusHewan = document.getElementById('statusHewan');
    const symptomsWrap = document.getElementById('symptomsWrap');
    const symErr = document.getElementById('symErr');

    // Section 3
    const hasLabRadios = () => document.querySelector('input[name="hasLab"]:checked');

    // Section 4 refs
    const labName = document.getElementById('labName');
    const specimenType = document.getElementById('specimenType');
    const specimenId = document.getElementById('specimenId');
    const collectionDate = document.getElementById('collectionDate');
    const resultDate = document.getElementById('resultDate');
    const examMethod = document.getElementById('examMethod');
    const equipment = document.getElementById('equipment');
    const reagent = document.getElementById('reagent');
    const examResult = document.getElementById('examResult');

    // Validations
    function validStep0(){ return lapGigitan.checked; }
    function validStep1(){
      const nikOk = nikEl.value.length === 16;
      const namaOk = namaLengkap.value.trim().length > 0;
      const alamatOk = alamatKejadianEl.value.trim().length > 5;
      const kecOk = kecEl.value !== '';
      const kelOk = kelEl.value !== '';
      return nikOk && namaOk && alamatOk && kecOk && kelOk;
    }
    function validStep2(){
  const td = !!tanggalDigigit.value;
  const j = !!jenisHewan.value; 
  // Validasi checkbox area gigitan (minimal 1 checked)
  const checkedLokasiGigitan = [...lokasiGigitanCheckboxes()].filter(cb => cb.checked);
  const l = checkedLokasiGigitan.length > 0; 
  const kl = !!kondisiLuka.value;
  const pg = !!pengobatan.value;
  const sp = !!statusPemilik.value; 
  const sh = !!statusHewan.value;
  const anySym = [...symptomsWrap.querySelectorAll('input[type="checkbox"]')].some(cb=>cb.checked);
  
  // Validasi field "Lainnya"
  let jenisHewanValid = true;
  if (jenisHewan.value === 'Lainnya') {
    jenisHewanValid = document.getElementById('jenisHewanLainnya').value.trim().length > 0;
  }
  
  // Validasi field "Lainnya" untuk Lokasi Gigitan (checkbox-based)
  let lokasiGigitanValid = true;
  if (lokasiGigitanLainnyaCheckbox && lokasiGigitanLainnyaCheckbox.checked) {
    lokasiGigitanValid = document.getElementById('lokasiGigitanLainnya').value.trim().length > 0;
  }
  
  let kondisiLukaValid = true;
  if (kondisiLuka.value === 'Lainnya') {
    kondisiLukaValid = document.getElementById('kondisiLukaLainnya').value.trim().length > 0;
  }
  
  symErr.classList.toggle('hidden', anySym);
  lokasiGigitanErr.classList.toggle('hidden', l);  // Tambah baris ini
  return td && j && l && kl && pg && sp && sh && anySym && jenisHewanValid && lokasiGigitanValid && kondisiLukaValid;
}
    function validStep3(){ return !!hasLabRadios(); }
    function validStep4(){
      return labName.value && specimenType.value.trim() && specimenId.value.trim() && collectionDate.value && resultDate.value && examMethod.value && equipment.value && reagent.value && examResult.value;
    }

    function updateCTA(){
      if (view!=='case'){ return; }
      let enable=false; let label='Berikutnya';
      if (step===0){ enable = validStep0(); label='Lanjut ke Data Pasien'; }
      else if (step===1){ enable = validStep1(); label='Lanjut ke Kondisi Hewan'; }
      else if (step===2){ enable = validStep2(); label='Lanjut ke Pemeriksaan Lab'; }
      else if (step===3){
        enable = validStep3();
        const ans = hasLabRadios()?.value;
        label = ans==='ya' ? 'Lanjut Isi Detail Lab' : 'Selesai';
      }
      else if (step===4){ enable = validStep4(); label='Simpan Hasil Lab & Kirim Laporan'; }

      nextBtn.disabled = !enable;
      nextBtn.classList.toggle('disabled', !enable);
      nextBtn.classList.toggle('bg-[var(--brand)]', enable);
      nextBtn.classList.toggle('bg-slate-300', !enable);
      nextBtn.querySelector('span').textContent = label;
    }

    nextBtn.addEventListener('click', () => {
      if (step===0 && validStep0()) { step=1; showView(); updateCTA(); return; }
      if (step===1 && validStep1()) { step=2; showView(); updateCTA(); return; }
      if (step===2 && validStep2()) { step=3; showView(); updateCTA(); return; }
      if (step===3) {
        const isValid = validStep3();
        if (isValid) {
          const labRadio = hasLabRadios();
          const ans = labRadio ? labRadio.value : null;
          if (ans === 'ya') { step=4; showView(); updateCTA(); return; }
          if (ans === 'tidak') {
            const konfirmasi = confirm('Apakah Anda yakin akan mengirim laporan kasus ini?');
            if (konfirmasi) {
              savePatient();
              showToast('Data laporan kasus berhasil disimpan!');
              resetCaseForm();
              view='menu'; 
              showView();
            }
          }
        }
        return;
      }
      if (step===4) {
        const isValid = validStep4();
        if (isValid) {
          const konfirmasi = confirm('Apakah Anda yakin akan mengirim laporan kasus dan hasil laboratorium ini?');
          if (konfirmasi) {
            savePatient();
            showToast('Laporan kasus dan hasil lab berhasil disimpan!');
            resetCaseForm();
            view='menu'; 
            showView();
          }
        }
      }
    });

// ============================================
// FUNCTION savePatient() - VERSI FIXED
// ============================================
// Copy SELURUH function ini untuk replace function savePatient() yang lama

function savePatient() {
  // Ambil nilai final dengan mempertimbangkan "Lainnya"
  // Versi SAFE dengan pengecekan element exists
  
  let finalJenisHewan = jenisHewan.value;
  if (finalJenisHewan === 'Lainnya') {
    const inputElement = document.getElementById('jenisHewanLainnya');
    if (inputElement && inputElement.value.trim()) {
      finalJenisHewan = inputElement.value.trim();
    }
  }

  // Ambil nilai final untuk Lokasi Gigitan (checkbox-based)
  const checkedLokasiGigitan = [...lokasiGigitanCheckboxes()]
    .filter(cb => cb.checked)
    .map(cb => {
      // Jika checkbox "Lainnya" dicentang, gunakan input text
      if (cb.value === 'Lainnya') {
        const lainnyaInput = document.getElementById('lokasiGigitanLainnya');
        return lainnyaInput && lainnyaInput.value.trim() ? lainnyaInput.value.trim() : 'Lainnya';
      }
      return cb.value;
    });
  const finalLokasiGigitan = checkedLokasiGigitan.join(', ');

  let finalKondisiLuka = kondisiLuka.value;
  if (finalKondisiLuka === 'Lainnya') {
    const inputElement = document.getElementById('kondisiLukaLainnya');
    if (inputElement && inputElement.value.trim()) {
      finalKondisiLuka = inputElement.value.trim();
    }
  }

  const caseData = {
    inputDate: new Date().toLocaleDateString('id-ID', {day: '2-digit', month: 'short', year: 'numeric'}).toUpperCase(),
    nik: nikEl.value,
    name: namaLengkap.value.trim(),
    gender: genderEl.textContent,
    birthDate: dobEl.textContent,
    province: provEl.textContent,
    district: kabEl.textContent,
    kec: kecEl.value.toUpperCase(),
    kel: kelEl.value.toUpperCase(),
    registeredAddress: alamatKejadianEl.value.trim(),
    residentialAddress: document.getElementById('alamatDomisili').value.trim(),
    phone: document.getElementById('telp').value.trim(),
    
    diagnosis: 'Gigitan Hewan Penular Rabies (GHPR)',
    tanggalDigigit: tanggalDigigit.value ? new Date(tanggalDigigit.value).toLocaleDateString('id-ID', {day: '2-digit', month: 'short', year: 'numeric'}).toUpperCase() : '-',
    animalType: finalJenisHewan,
    biteLocation: finalLokasiGigitan,
    kondisiLuka: finalKondisiLuka,
    pengobatan: pengobatan.value,
    biteCategory: kategoriGigitan.value || '-',
    animalOwnership: statusPemilik.value,
    animalStatus: statusHewan.value,
    symptoms: [...symptomsWrap.querySelectorAll('input[type="checkbox"]:checked')].map(cb => cb.value).join(', '),
    
    hasLab: hasLabRadios()?.value || 'tidak',
    laboratory: labName.value || '-',
    specimenType: specimenType.value.trim() || '-',
    specimenId: specimenId.value.trim() || '-',
    collectionDate: collectionDate.value ? new Date(collectionDate.value).toLocaleDateString('id-ID', {day: '2-digit', month: 'short', year: 'numeric'}).toUpperCase() : '-',
    resultDate: resultDate.value ? new Date(resultDate.value).toLocaleDateString('id-ID', {day: '2-digit', month: 'short', year: 'numeric'}).toUpperCase() : '-',
    examMethod: examMethod.value || '-',
    equipment: equipment.value || '-',
    reagent: reagent.value || '-',
    examResult: examResult.value || '-'
  };
  
  const existingIndex = patients.findIndex(p => p.nik === caseData.nik);
  if (existingIndex === -1) {
    patients.push(caseData);
  } else {
    patients[existingIndex] = caseData;
  }
}

    // Inputs -> recalc CTA
    document.addEventListener('change', (e)=>{ if(e.target.name==='jenisLaporan'){ updateCTA(); }});
    if (nikEl){
      nikEl.addEventListener('input', (e)=>{
        e.target.value = e.target.value.replace(/\D/g,'').slice(0,16);
        if(e.target.value.length===16){ nikErr.classList.add('hidden'); autofillFromNIK(e.target.value);} else { nikErr.classList.toggle('hidden', e.target.value.length===0); resetIdentity(); }
        updateCTA();
      });
    }
    alamatKejadianEl.addEventListener('input', updateCTA);
    namaLengkap.addEventListener('input', updateCTA);
    kecEl.addEventListener('change', ()=> { populateKelurahan(); updateCTA(); });
    kelEl.addEventListener('change', updateCTA);
    // Event listeners untuk dropdown (tanpa lokasiGigitan karena sudah jadi checkbox)
[tanggalDigigit,jenisHewan,kondisiLuka,pengobatan,statusPemilik,statusHewan].forEach(el=> el.addEventListener('change', updateCTA));
    symptomsWrap.addEventListener('change', updateCTA);
    document.addEventListener('change', (e)=>{ if(e.target.name==='hasLab') updateCTA(); });

    const sameAsKejadianCheckbox = document.getElementById('sameAsKejadian');
    const alamatDomisiliField = document.getElementById('alamatDomisili');
    
    sameAsKejadianCheckbox.addEventListener('change', function() {
      if (this.checked) {
        const alamatKejadian = alamatKejadianEl.value.trim();
        alamatDomisiliField.value = alamatKejadian;
        alamatDomisiliField.readOnly = true;
        alamatDomisiliField.classList.add('bg-slate-100', 'cursor-not-allowed');
      } else {
        alamatDomisiliField.value = '';
        alamatDomisiliField.readOnly = false;
        alamatDomisiliField.classList.remove('bg-slate-100', 'cursor-not-allowed');
      }
    });
    
    alamatKejadianEl.addEventListener('input', function() {
      if (sameAsKejadianCheckbox.checked) {
        alamatDomisiliField.value = this.value;
      }
    });
    [labName,specimenType,specimenId,collectionDate,resultDate,examMethod,equipment,reagent,examResult].forEach(el=> el.addEventListener('input', updateCTA));

    // Helpers (NIK)
    function fmtDate(d){ return d.toLocaleDateString('id-ID',{day:'2-digit', month:'short', year:'numeric'}).toUpperCase(); }
    function calcUsia(dob){ const now=new Date(); let years=now.getFullYear()-dob.getFullYear(); let months=now.getMonth()-dob.getMonth(); let days=now.getDate()-dob.getDate(); if(days<0){months--;} if(months<0){years--; months+=12;} return {years, months}; }
    
    function autofillFromNIK(nik){ 
      const provCode=nik.slice(0,2); 
      const kabCode=nik.slice(0,4); 
      let dd=parseInt(nik.slice(6,8),10); 
      const mm=parseInt(nik.slice(8,10),10); 
      const yy=parseInt(nik.slice(10,12),10); 
      let gender='Laki-laki'; 
      if(dd>40){ dd-=40; gender='Perempuan'; } 
      const nowYY=new Date().getFullYear()%100; 
      const fullYear= yy<=nowYY ? 2000+yy : 1900+yy; 
      const dob=new Date(fullYear, mm-1, dd); 
      if(isNaN(dob.getTime())){ resetIdentity(); nikErr.classList.remove('hidden'); return; } 
      dobEl.textContent=fmtDate(dob); 
      const u=calcUsia(dob); 
      ageEl.textContent=`${u.years} thn ${u.months} bln`; 
      genderEl.textContent=gender; 
      provEl.textContent= ADM[provCode]?.name || `Kode Provinsi ${provCode}`; 
      kabEl.textContent= ADM[provCode]?.kab?.[kabCode]?.name || `Kode Kab/Kota ${kabCode}`; 
      
      // Populate kecamatan dropdown
      const kecData = ADM[provCode]?.kab?.[kabCode]?.kec;
      if (kecData && typeof kecData === 'object') {
        const kecList = Object.keys(kecData);
        kecEl.innerHTML = `<option value="">Pilih kecamatan‚Ä¶</option>` + kecList.map(k=>`<option value="${k}">${k}</option>`).join('');
      } else {
        kecEl.innerHTML = `<option value="">Pilih kecamatan‚Ä¶</option>`;
      }
      
      // Reset kelurahan dropdown
      kelEl.innerHTML = `<option value="">Pilih kelurahan/desa‚Ä¶</option>`;
    }
    
    function populateKelurahan() {
      const nik = nikEl.value;
      const provCode = nik.slice(0,2);
      const kabCode = nik.slice(0,4);
      const selectedKec = kecEl.value;
      
      if (!selectedKec) {
        kelEl.innerHTML = `<option value="">Pilih kelurahan/desa‚Ä¶</option>`;
        return;
      }
      
      const kelList = ADM[provCode]?.kab?.[kabCode]?.kec?.[selectedKec];
      if (kelList && Array.isArray(kelList)) {
        kelEl.innerHTML = `<option value="">Pilih kelurahan/desa‚Ä¶</option>` + kelList.map(k=>`<option value="${k}">${k}</option>`).join('');
      } else {
        kelEl.innerHTML = `<option value="">Pilih kelurahan/desa‚Ä¶</option>`;
      }
    }
    
    function resetIdentity(){ 
      dobEl.textContent='‚Äî'; 
      ageEl.textContent='‚Äî'; 
      genderEl.textContent='‚Äî'; 
      provEl.textContent='‚Äî'; 
      kabEl.textContent='‚Äî'; 
      kecEl.innerHTML = `<option value="">Pilih kecamatan‚Ä¶</option>`; 
      kelEl.innerHTML = `<option value="">Pilih kelurahan/desa‚Ä¶</option>`;
    }
    
    function showToast(message){
      const t = document.getElementById('toast'); const m = document.getElementById('toastMsg'); m.textContent = message; t.classList.remove('hidden');
      t.animate([{ transform: 'translate(-50%, 20px)', opacity: 0 },{ transform: 'translate(-50%, 0)', opacity: 1 }], { duration: 200, fill: 'forwards' });
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(()=>{ const anim = t.animate([{ opacity: 1 },{ opacity: 0 }], { duration: 250, fill: 'forwards' }); anim.onfinish = ()=> t.classList.add('hidden'); }, 2200);
    }
    
    function resetCaseForm(){
      lapGigitan.checked=false; 
      nikEl.value=''; 
      namaLengkap.value=''; 
      nikErr.classList.add('hidden'); 
      resetIdentity();
      alamatKejadianEl.value=''; 
      
      const alamatDomisiliField = document.getElementById('alamatDomisili');
      const sameAsKejadianCheckbox = document.getElementById('sameAsKejadian');
      
      alamatDomisiliField.value='';
      alamatDomisiliField.readOnly = false;
      alamatDomisiliField.classList.remove('bg-slate-100', 'cursor-not-allowed');
      sameAsKejadianCheckbox.checked = false;
      
      document.getElementById('telp').value='';
      tanggalDigigit.value='';
      jenisHewan.value='';  lokasiGigitanCheckboxes().forEach(cb => cb.checked = false); kondisiLuka.value=''; pengobatan.value=''; kategoriGigitan.value=''; statusPemilik.value=''; statusHewan.value='';
      [...symptomsWrap.querySelectorAll('input[type="checkbox"]')].forEach(cb=> cb.checked=false);
      document.querySelectorAll('input[name="hasLab"]').forEach(r=> r.checked=false);
      labName.value=''; specimenType.value=''; specimenId.value=''; collectionDate.value=''; resultDate.value=''; examMethod.value=''; equipment.value=''; reagent.value='';
	  // Reset field "Lainnya"
document.getElementById('jenisHewanLainnya').value = '';
document.getElementById('lokasiGigitanLainnya').value = '';
document.getElementById('kondisiLukaLainnya').value = '';
document.getElementById('jenisHewanLainnyaWrap').classList.add('hidden');
document.getElementById('lokasiGigitanLainnyaWrap').classList.add('hidden');
document.getElementById('kondisiLukaLainnyaWrap').classList.add('hidden');
      step=0;
    }

    // ====== Patients ======
    let patients = [];
    const patientListEl = document.getElementById('patientList');
    const patientEmptyEl = document.getElementById('patientEmpty');
    const searchEl = document.getElementById('searchPatient');

    function ageYearsFromNik(nik){
      let dd=parseInt(nik.slice(6,8),10); const mm=parseInt(nik.slice(8,10),10); const yy=parseInt(nik.slice(10,12),10);
      if (isNaN(dd)||isNaN(mm)||isNaN(yy)) return null; if(dd>40) dd-=40;
      const now=new Date(); const fullYear = (yy <= now.getFullYear()%100) ? 2000+yy : 1900+yy;
      const dob=new Date(fullYear,mm-1,dd); let age = now.getFullYear()-dob.getFullYear();
      const m = now.getMonth()-dob.getMonth(); if (m<0 || (m===0 && now.getDate()<dob.getDate())) age--;
      return age;
    }

    function renderPatients(keyword=''){
      const kw = keyword.trim().toLowerCase();
      const data = patients.map(p=>({...p, age: ageYearsFromNik(p.nik)}))
        .filter(p=> !kw || p.name.toLowerCase().includes(kw) || p.nik.includes(kw));

      patientListEl.innerHTML = data.map(p => `
        <button class="card text-left rounded-xl bg-white border shadow-card w-full">
          <div class="p-4">
            <div class="flex items-center justify-between">
              <div class="text-[15px] font-semibold text-slate-900 tracking-tight">${p.nik}</div>
              <svg class="h-5 w-5 text-slate-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </div>
            <div class="mt-3 grid grid-cols-[160px_1fr] gap-1 text-sm">
              <div class="text-slate-500">Nama Lengkap</div><div class="font-semibold">${p.name}</div>
              <div class="text-slate-500">Usia</div><div class="font-semibold">${(p.age ?? '‚Äî')} tahun</div>
			  <div class="text-slate-500">Tanggal Digigit</div><div class="font-semibold">${p.tanggalDigigit ?? '‚Äî'}</div>
            </div>
          </div>
        </button>
      `).join('');

      [...patientListEl.querySelectorAll('button.card')].forEach((el, idx) => {
        el.addEventListener('click', () => {
          selectedPatient = data[idx];
          view='patientDetail'; showView();
        });
      });

      patientEmptyEl.classList.toggle('hidden', data.length>0);
    }

    function renderPatientDetail(p){
      // Patient Data
      document.getElementById('detInputDate').textContent = p.inputDate || '‚Äî';
      document.getElementById('detNik').textContent = p.nik || '‚Äî';
      document.getElementById('detName').textContent = p.name || '‚Äî';
      document.getElementById('detGender').textContent = p.gender || '‚Äî';
      document.getElementById('detBirthDate').textContent = p.birthDate || '‚Äî';
      document.getElementById('detProvince').textContent = p.province || '‚Äî';
      document.getElementById('detDistrict').textContent = p.district || '‚Äî';
      document.getElementById('detKec').textContent = p.kec || '‚Äî';
      document.getElementById('detKel').textContent = p.kel || '‚Äî';
      document.getElementById('detRegisteredAddress').textContent = p.registeredAddress || '‚Äî';
      document.getElementById('detResidentialAddress').textContent = p.residentialAddress || '‚Äî';
      document.getElementById('detPhone').textContent = p.phone || '‚Äî';
      
      // Case Report
      document.getElementById('detDiagnosis').textContent = p.diagnosis || '‚Äî';
      document.getElementById('detTanggalDigigit').textContent = p.tanggalDigigit || '‚Äî';
      document.getElementById('detAnimalType').textContent = p.animalType || '‚Äî';
      document.getElementById('detBiteLocation').textContent = p.biteLocation || '‚Äî';
      document.getElementById('detKondisiLuka').textContent = p.kondisiLuka || '‚Äî';
      document.getElementById('detPengobatan').textContent = p.pengobatan || '‚Äî';
      document.getElementById('detBiteCategory').textContent = p.biteCategory || '‚Äî';
      document.getElementById('detAnimalOwnership').textContent = p.animalOwnership || '‚Äî';
      document.getElementById('detAnimalStatus').textContent = p.animalStatus || '‚Äî';
      document.getElementById('detSymptoms').textContent = p.symptoms || '‚Äî';
      
      // Laboratory Examination
      const labSection = document.getElementById('detLabSection');
      const labAnswer = document.getElementById('detLabAnswer');
      const labDetails = document.getElementById('detLabDetails');
      
      if (p.hasLab) {
        labSection.classList.remove('hidden');
        labAnswer.textContent = p.hasLab === 'ya' ? 'Ya' : 'Tidak';
        
        if (p.hasLab === 'ya') {
          labDetails.classList.remove('hidden');
          document.getElementById('detLaboratory').textContent = p.laboratory || '‚Äî';
          document.getElementById('detSpecimenType').textContent = p.specimenType || '‚Äî';
          document.getElementById('detSpecimenId').textContent = p.specimenId || '‚Äî';
          document.getElementById('detCollectionDate').textContent = p.collectionDate || '‚Äî';
          document.getElementById('detResultDate').textContent = p.resultDate || '‚Äî';
          document.getElementById('detExamMethod').textContent = p.examMethod || '‚Äî';
          document.getElementById('detEquipment').textContent = p.equipment || '‚Äî';
          document.getElementById('detReagent').textContent = p.reagent || '‚Äî';
          document.getElementById('detExamResult').textContent = p.examResult || '‚Äî';
        } else {
          labDetails.classList.add('hidden');
        }
      } else {
        labSection.classList.add('hidden');
      }
    }

    searchEl.addEventListener('input', ()=> renderPatients(searchEl.value));

    // ====== Init ======
    renderPatients();
    showView();
    updateCTA();
	
	// Event listeners untuk show/hide field "Lainnya"
jenisHewan.addEventListener('change', function() {
  const lainnyaWrap = document.getElementById('jenisHewanLainnyaWrap');
  const lainnyaInput = document.getElementById('jenisHewanLainnya');
  
  if (this.value === 'Lainnya') {
    lainnyaWrap.classList.remove('hidden');
  } else {
    lainnyaWrap.classList.add('hidden');
    lainnyaInput.value = '';
  }
  updateCTA();
});


kondisiLuka.addEventListener('change', function() {
  const lainnyaWrap = document.getElementById('kondisiLukaLainnyaWrap');
  const lainnyaInput = document.getElementById('kondisiLukaLainnya');
  
  if (this.value === 'Lainnya') {
    lainnyaWrap.classList.remove('hidden');
  } else {
    lainnyaWrap.classList.add('hidden');
    lainnyaInput.value = '';
  }
  updateCTA();
});

// Event listener untuk checkbox "Lainnya" di Area Gigitan
if (lokasiGigitanLainnyaCheckbox) {
  lokasiGigitanLainnyaCheckbox.addEventListener('change', function() {
    const lainnyaWrap = document.getElementById('lokasiGigitanLainnyaWrap');
    const lainnyaInput = document.getElementById('lokasiGigitanLainnya');
    
    if (this.checked) {
      lainnyaWrap.classList.remove('hidden');
    } else {
      lainnyaWrap.classList.add('hidden');
      lainnyaInput.value = '';
    }
    updateCTA();
  });
}

// Event listener untuk semua checkbox area gigitan
lokasiGigitanCheckboxes().forEach(checkbox => {
  checkbox.addEventListener('change', updateCTA);
});

// Event listeners untuk update CTA
const jenisHewanLainnyaInput = document.getElementById('jenisHewanLainnya');
const lokasiGigitanLainnyaInput = document.getElementById('lokasiGigitanLainnya');
const kondisiLukaLainnyaInput = document.getElementById('kondisiLukaLainnya');

if (jenisHewanLainnyaInput) jenisHewanLainnyaInput.addEventListener('input', updateCTA);
if (lokasiGigitanLainnyaInput) lokasiGigitanLainnyaInput.addEventListener('input', updateCTA);
if (kondisiLukaLainnyaInput) kondisiLukaLainnyaInput.addEventListener('input', updateCTA);

    // ============================================
    // EDIT PEMERIKSAAN LAB
    // ============================================

    let editingPatientIndex = null;

    // Show Edit Lab Form
    function showEditLabForm() {
      if (!selectedPatient) {
        alert('Tidak ada pasien yang dipilih!');
        return;
      }
      
      // Cari index pasien di array patients
      editingPatientIndex = patients.findIndex(p => p.nik === selectedPatient.nik);
      if (editingPatientIndex === -1) {
        alert('Data pasien tidak ditemukan!');
        return;
      }
      
      // Populate form dengan data existing
      const patient = patients[editingPatientIndex];
      
      // Set radio hasLab
      if (patient.hasLab === 'ya') {
        document.getElementById('editHasLabYa').checked = true;
        document.getElementById('editLabFieldsWrap').style.display = 'block';
      } else {
        document.getElementById('editHasLabTidak').checked = true;
        document.getElementById('editLabFieldsWrap').style.display = 'none';
      }
      
      // Populate field lab
      document.getElementById('editLabName').value = patient.laboratory && patient.laboratory !== '-' ? patient.laboratory : '';
      document.getElementById('editSpecimenType').value = patient.specimenType && patient.specimenType !== '-' ? patient.specimenType : '';
      document.getElementById('editSpecimenId').value = patient.specimenId && patient.specimenId !== '-' ? patient.specimenId : '';
      
      // Convert tanggal dari format display ke format input (YYYY-MM-DD)
      document.getElementById('editCollectionDate').value = convertDisplayToInputDate(patient.collectionDate);
      document.getElementById('editResultDate').value = convertDisplayToInputDate(patient.resultDate);
      
      document.getElementById('editExamMethod').value = patient.examMethod && patient.examMethod !== '-' ? patient.examMethod : '';
      document.getElementById('editEquipment').value = patient.equipment && patient.equipment !== '-' ? patient.equipment : '';
      document.getElementById('editReagent').value = patient.reagent && patient.reagent !== '-' ? patient.reagent : '';
      document.getElementById('editExamResult').value = patient.examResult && patient.examResult !== '-' ? patient.examResult : '';
      
      // Show edit view
      view = 'editLab';
      showView();
    }

    // Helper: Convert display date (20 NOV 2024) to input date (2024-11-20)
    function convertDisplayToInputDate(displayDate) {
      if (!displayDate || displayDate === '‚Äî' || displayDate === '-') return '';
      
      try {
        // Parse format: "20 NOV 2024"
        const parts = displayDate.trim().split(' ');
        if (parts.length !== 3) return '';
        
        const day = parts[0].padStart(2, '0');
        const monthMap = {
          'JAN': '01', 'FEB': '02', 'MAR': '03', 'APR': '04',
          'MAY': '05', 'MEI': '05', 'JUN': '06', 'JUL': '07', 
          'AUG': '08', 'AGU': '08', 'SEP': '09', 'OCT': '10', 
          'OKT': '10', 'NOV': '11', 'DEC': '12', 'DES': '12'
        };
        const month = monthMap[parts[1].toUpperCase()];
        if (!month) return '';
        
        const year = parts[2];
        
        return `${year}-${month}-${day}`;
      } catch (e) {
        console.error('Error converting date:', e);
        return '';
      }
    }

    // Validate Edit Lab Form
    function validateEditLabForm() {
      const hasLabYa = document.getElementById('editHasLabYa').checked;
      const hasLabTidak = document.getElementById('editHasLabTidak').checked;
      
      // Must select hasLab
      if (!hasLabYa && !hasLabTidak) {
        alert('Pilih apakah sudah dilakukan pemeriksaan lab atau belum!');
        return false;
      }
      
      // If Ya, validate required fields
      if (hasLabYa) {
        const labName = document.getElementById('editLabName').value.trim();
        const specimenType = document.getElementById('editSpecimenType').value.trim();
        const collectionDate = document.getElementById('editCollectionDate').value;
        const resultDate = document.getElementById('editResultDate').value;
        const examMethod = document.getElementById('editExamMethod').value;
        const equipment = document.getElementById('editEquipment').value;
        const reagent = document.getElementById('editReagent').value;
        const examResult = document.getElementById('editExamResult').value;
        
        if (!labName) {
          alert('Laboratorium harus dipilih!');
          document.getElementById('editLabName').focus();
          return false;
        }
        if (!specimenType) {
          alert('Jenis Spesimen harus diisi!');
          document.getElementById('editSpecimenType').focus();
          return false;
        }
        if (!collectionDate) {
          alert('Tanggal Pengambilan Spesimen harus diisi!');
          document.getElementById('editCollectionDate').focus();
          return false;
        }
        if (!resultDate) {
          alert('Tanggal Hasil Lab harus diisi!');
          document.getElementById('editResultDate').focus();
          return false;
        }
        if (!examMethod) {
          alert('Metode Pemeriksaan harus dipilih!');
          document.getElementById('editExamMethod').focus();
          return false;
        }
        if (!equipment) {
          alert('Peralatan Utama harus dipilih!');
          document.getElementById('editEquipment').focus();
          return false;
        }
        if (!reagent) {
          alert('Bahan Habis Pakai / Reagen harus dipilih!');
          document.getElementById('editReagent').focus();
          return false;
        }
        if (!examResult) {
          alert('Hasil Pemeriksaan harus dipilih!');
          document.getElementById('editExamResult').focus();
          return false;
        }
      }
      
      return true;
    }

    // Save Edit Lab
    function saveEditLab() {
      if (!validateEditLabForm()) return;
      
      if (editingPatientIndex === null || editingPatientIndex === -1) {
        alert('Data pasien tidak ditemukan!');
        return;
      }
      
      const hasLabYa = document.getElementById('editHasLabYa').checked;
      
      // Update patient data
      patients[editingPatientIndex].hasLab = hasLabYa ? 'ya' : 'tidak';
      
      if (hasLabYa) {
        patients[editingPatientIndex].laboratory = document.getElementById('editLabName').value;
        patients[editingPatientIndex].specimenType = document.getElementById('editSpecimenType').value.trim();
        patients[editingPatientIndex].specimenId = document.getElementById('editSpecimenId').value.trim();
        
        const collectionDate = document.getElementById('editCollectionDate').value;
        patients[editingPatientIndex].collectionDate = collectionDate ? 
          new Date(collectionDate).toLocaleDateString('id-ID', {day: '2-digit', month: 'short', year: 'numeric'}).toUpperCase() : '-';
        
        const resultDate = document.getElementById('editResultDate').value;
        patients[editingPatientIndex].resultDate = resultDate ? 
          new Date(resultDate).toLocaleDateString('id-ID', {day: '2-digit', month: 'short', year: 'numeric'}).toUpperCase() : '-';
        
        patients[editingPatientIndex].examMethod = document.getElementById('editExamMethod').value;
        patients[editingPatientIndex].equipment = document.getElementById('editEquipment').value;
        patients[editingPatientIndex].reagent = document.getElementById('editReagent').value;
        patients[editingPatientIndex].examResult = document.getElementById('editExamResult').value;
      } else {
        // If tidak, set semua field lab ke default
        patients[editingPatientIndex].laboratory = '-';
        patients[editingPatientIndex].specimenType = '-';
        patients[editingPatientIndex].specimenId = '-';
        patients[editingPatientIndex].collectionDate = '-';
        patients[editingPatientIndex].resultDate = '-';
        patients[editingPatientIndex].examMethod = '-';
        patients[editingPatientIndex].equipment = '-';
        patients[editingPatientIndex].reagent = '-';
        patients[editingPatientIndex].examResult = '-';
      }
      
      // Update selectedPatient
      selectedPatient = patients[editingPatientIndex];
      
      // Show success message
      alert('‚úÖ Data pemeriksaan laboratorium berhasil diperbarui!');
      
      // Redirect to patient detail
      view = 'patientDetail';
      showView();
    }

    // Cancel Edit Lab
    function cancelEditLab() {
      if (confirm('Batalkan perubahan? Data yang sudah diisi akan hilang.')) {
        view = 'patientDetail';
        showView();
      }
    }

    // Event listener untuk radio hasLab
    (function() {
      // Tunggu sampai DOM loaded
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initEditLabListeners);
      } else {
        initEditLabListeners();
      }
      
      function initEditLabListeners() {
        const editHasLabRadios = document.querySelectorAll('.edit-has-lab-radio');
        if (editHasLabRadios.length > 0) {
          editHasLabRadios.forEach(radio => {
            radio.addEventListener('change', function() {
              const fieldsWrap = document.getElementById('editLabFieldsWrap');
              if (this.value === 'ya') {
                fieldsWrap.style.display = 'block';
              } else {
                fieldsWrap.style.display = 'none';
              }
            });
          });
        }
      }
    })();

  </script>
</body>
</html>
